<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CertiFY ‚Äî Login & Registro</title>
  <!-- (Opcional) si ya usas un CSS global -->
  <link rel="stylesheet" href="/style_global.css"/>

  <style>
    :root{
      --bg:#f7f8ff; --surface:#fafbff; --card:#ffffff; --ink:#1b1f3a; --muted:#6c6f91;
      --brand:#161a3f; --bd:#e7eafe; --ring:rgba(90,100,200,.18); --shadow:0 8px 24px rgba(28,27,70,.08);
      --radius:16px;
      --aws-500:#ff9900; --az-500:#0078d4;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Helvetica Neue", "Noto Sans", sans-serif;
      color:var(--ink);
      background:
        radial-gradient(900px 420px at 12% -10%, #f1f4ff 0, transparent 60%),
        radial-gradient(900px 420px at 88% -10%, #fff4ea 0, transparent 60%),
        linear-gradient(180deg, var(--surface) 0%, var(--bg) 100%);
      line-height:1.6; min-height:100vh;
    }
    .wrap{max-width:980px;margin:0 auto;padding:24px 20px}

    /* Tarjetas y botones */
    .card{
      background:var(--card); border:1px solid var(--bd); border-radius:var(--radius); padding:22px;
      box-shadow:var(--shadow);
    }
    .btn{
      appearance:none; border:1px solid #e7eafe; cursor:pointer; background:#f5f7ff; color:#262a52;
      font-weight:900; letter-spacing:.2px; padding:12px 16px; border-radius:12px; box-shadow:0 6px 16px rgba(25,22,84,.06);
      transition:transform .08s ease, box-shadow .12s ease, background .12s ease, color .12s ease, border-color .12s ease;
    }
    .btn:hover{ transform:translateY(-1px); box-shadow:0 10px 18px rgba(25,22,84,.08); background:#eef1ff }
    .btn.primary{ background:var(--az-500); color:#fff; border-color:#98cfff; }
    .btn.primary:hover{ filter:brightness(.96) }
    .btn.link{ background:#fff; }

    /* HERO */
    .hero{ text-align:center; border:1px solid #ecefff; padding:28px 20px 18px; background:linear-gradient(180deg,#ffffff 0,#fbfcff 100%); }
    .hero h1{ font-size:clamp(1.6rem,2.2vw + 1rem,2.2rem); line-height:1.15; margin:6px 0 8px; font-weight:900; color:var(--brand); }
    .hero .desc{ color:var(--muted); max-width:760px; margin:0 auto; }

    /* Auth bar superior */
    .authbar{
      display:flex; align-items:center; justify-content:space-between; gap:12px; margin:16px 0 18px;
      padding:10px 14px; background:#fff; border:1px solid #ecefff; border-radius:999px; color:#2a2e57; font-weight:700;
      box-shadow:0 4px 12px rgba(30,35,80,.06);
    }
    .authbar .actions{ display:flex; gap:8px; }
    .authbar .muted{ color:#8b8fb3; font-weight:700; }
    .hidden{ display:none !important; }

    /* Pesta√±as Login/Registro */
    .tabs{
      display:flex; gap:8px; background:#f6f7ff; border:1px solid #e6e9ff; border-radius:12px; padding:6px;
      width:fit-content; margin:0 auto 14px;
    }
    .tab-btn{
      border:1px solid transparent; background:transparent; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:900; color:#343a6e;
    }
    .tab-btn.active{ background:#fff; border-color:#e6e9ff; }

    /* Formularios */
    .form-card{ max-width:560px; margin:0 auto; }
    .field{ display:flex; flex-direction:column; gap:6px; margin:10px 0; }
    .field label{ font-weight:800; color:#2a2e57; }
    .control{
      display:flex; align-items:center; gap:8px; border:1px solid #e6e9ff; border-radius:10px; padding:10px 12px; background:#fff;
    }
    .control input{
      border:none; outline:none; width:100%; font-weight:700; color:#2a2e57; background:transparent; padding:4px 0;
    }
    .form-actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:10px; }
    .hint{ color:var(--muted); font-size:.92rem; }
    .err{ color:#b3261e; font-weight:800; margin-top:6px; }

    /* Pie de enlaces */
    .footer-links{ text-align:center; margin-top:14px; }
    .footer-links a{ font-weight:900; color:#0a4a7b; text-decoration:none; }
    .footer-links a:hover{ text-decoration:underline; }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- HERO -->
    <section class="card hero">
      <h1>Accede a CertiFY</h1>
      <p class="desc">Inicia sesi√≥n o crea tu cuenta para guardar tu progreso, aparecer en el ranking y continuar tus simuladores donde lo dejaste.</p>
    </section>

    <!-- AUTH BAR -->
    <section class="authbar" id="authBar">
      <span id="authText" class="muted">üîí No Authenticated :(</span>
      <div class="actions">
        <button id="btnLogin" class="btn">Login</button>
        <button id="btnSignup" class="btn">Register</button>
        <button id="btnLogout" class="btn hidden">Sign out</button>
      </div>
    </section>

    <!-- PESTA√ëAS -->
    <div class="tabs">
      <button id="tabLogin" class="tab-btn active" type="button">Login</button>
      <button id="tabSignup" class="tab-btn" type="button">Registro</button>
    </div>

    <!-- FORM LOGIN -->
    <form id="loginForm" class="card form-card" autocomplete="on">
      <h3 style="margin:4px 0 8px">Login</h3>
      <div class="field">
        <label for="loginEmail">Email</label>
        <div class="control">
          <input type="email" id="loginEmail" required placeholder="tu@email.com" />
        </div>
      </div>
      <div class="field">
        <label for="loginPass">Password</label>
        <div class="control">
          <input type="password" id="loginPass" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        </div>
      </div>
      <div id="loginErr" class="err hidden"></div>
      <div class="form-actions">
        <button class="btn link" type="button" id="goHome">Cancelar</button>
        <button class="btn primary" type="submit">Certify!</button>
      </div>
      <p class="hint">¬øSin cuenta? Pulsa en <b>Registro</b> arriba.</p>
    </form>

    <!-- FORM SIGNUP -->
    <form id="signupForm" class="card form-card hidden" autocomplete="on">
      <h3 style="margin:4px 0 8px">Crear cuenta</h3>
      <div class="field">
        <label for="signupName">Nombre</label>
        <div class="control">
          <input type="text" id="signupName" required placeholder="Tu nombre" />
        </div>
      </div>
      <div class="field">
        <label for="signupEmail">Email</label>
        <div class="control">
          <input type="email" id="signupEmail" required placeholder="tu@email.com" />
        </div>
      </div>
      <div class="field">
        <label for="signupPass">Password</label>
        <div class="control">
          <input type="password" id="signupPass" required minlength="6" placeholder="M√≠n. 6 caracteres" />
        </div>
      </div>
      <div id="signupErr" class="err hidden"></div>
      <div class="form-actions">
        <button class="btn link" type="button" id="goHome2">Cancelar</button>
        <button class="btn primary" type="submit">Certify!</button>
      </div>
      <p class="hint">Al registrarte aceptas nuestras pol√≠ticas. Podr√°s iniciar sesi√≥n de inmediato.</p>
    </form>

    <p class="footer-links">
      <a href="/">‚Üê Volver al inicio</a> ¬∑
      <a href="/score/ranking.html">üèÜ Ver Ranking</a>
    </p>
  </div>

  <script>
    const API_URL = "https://uougu1cm26.execute-api.eu-central-1.amazonaws.com";

    // ====== AUTH STORAGE ======
    const AUTH_KEY = "currentUser";
    function setCurrentUser(user) {
      localStorage.setItem(AUTH_KEY, JSON.stringify(user));
      renderAuthUI();
    }
    function getCurrentUser() {
      try { return JSON.parse(localStorage.getItem(AUTH_KEY) || "null"); }
      catch { return null; }
    }
    function clearCurrentUser() {
      localStorage.removeItem(AUTH_KEY);
      renderAuthUI();
    }

    // ====== RENDER UI ======
    function renderAuthUI() {
      const u = getCurrentUser();
      const authText = document.getElementById("authText");
      const btnLogin = document.getElementById("btnLogin");
      const btnSignup = document.getElementById("btnSignup");
      const btnLogout = document.getElementById("btnLogout");
      const loginForm = document.getElementById("loginForm");
      const signupForm = document.getElementById("signupForm");
      const tabLogin = document.getElementById("tabLogin");
      const tabSignup = document.getElementById("tabSignup");

      if (u) {
        authText.textContent = `‚úÖ You are sign-in as: ${u.name} (${u.email})`;
        btnLogin.classList.add("hidden");
        btnSignup.classList.add("hidden");
        btnLogout.classList.remove("hidden");
        loginForm.classList.add("hidden");
        signupForm.classList.add("hidden");
        tabLogin.classList.remove("active");
        tabSignup.classList.remove("active");
      } else {
        authText.textContent = "üîí No Authenticated :(";
        btnLogin.classList.remove("hidden");
        btnSignup.classList.remove("hidden");
        btnLogout.classList.add("hidden");
      }
    }

    function showForm(which){ // "login" | "signup"
      const loginForm = document.getElementById("loginForm");
      const signupForm = document.getElementById("signupForm");
      const tabLogin = document.getElementById("tabLogin");
      const tabSignup = document.getElementById("tabSignup");
      if (which === "signup") {
        signupForm.classList.remove("hidden");
        loginForm.classList.add("hidden");
        tabSignup.classList.add("active");
        tabLogin.classList.remove("active");
      } else {
        loginForm.classList.remove("hidden");
        signupForm.classList.add("hidden");
        tabLogin.classList.add("active");
        tabSignup.classList.remove("active");
      }
      // limpiar errores visibles
      document.getElementById("loginErr").classList.add("hidden");
      document.getElementById("signupErr").classList.add("hidden");
    }

    // ====== ARRANQUE ======
    document.addEventListener("DOMContentLoaded", () => {
      renderAuthUI();
      // detectar query/hash
      const isSignup =
        location.hash === "#signup" ||
        new URLSearchParams(location.search).get("view") === "signup";
      showForm(isSignup ? "signup" : "login");
    });

    // ====== TOP ACTIONS ======
    document.getElementById("btnLogout").onclick = () => {
      clearCurrentUser();
      alert("Sesi√≥n cerrada");
      showForm("login");
    };
    document.getElementById("btnLogin").onclick = () => showForm("login");
    document.getElementById("btnSignup").onclick = () => showForm("signup");
    document.getElementById("tabLogin").onclick = () => showForm("login");
    document.getElementById("tabSignup").onclick = () => showForm("signup");
    document.getElementById("goHome").onclick = () => history.back();
    document.getElementById("goHome2").onclick = () => history.back();

    // ====== HELPERS ======
    function showError(id, msg){
      const el = document.getElementById(id);
      el.textContent = msg || "Error";
      el.classList.remove("hidden");
      setTimeout(() => el.classList.add("hidden"), 4000);
    }

    // ====== SIGNUP ======
    document.getElementById("signupForm").addEventListener("submit", async e => {
      e.preventDefault();
      const name = signupName.value.trim();
      const email = signupEmail.value.trim().toLowerCase();
      const password = signupPass.value;

      if (!name || !email || !password) {
        showError("signupErr", "Completa todos los campos.");
        return;
      }

      try{
        const body = new URLSearchParams({ name, email, password });
        const resp = await fetch(`${API_URL}/signup`, { method: "POST", body, mode: "cors" });
        const data = await resp.json();
        if (resp.ok) {
          alert("Usuario creado con √©xito, ahora puedes iniciar sesi√≥n");
          showForm("login");
        } else {
          showError("signupErr", data.error || "Error en el registro");
        }
      }catch(err){
        showError("signupErr", err.message || "Error en el registro");
      }
    });

    // ====== LOGIN ======
    document.getElementById("loginForm").addEventListener("submit", async e => {
      e.preventDefault();
      const email = loginEmail.value.trim().toLowerCase();
      const password = loginPass.value;
      if (!email || !password) {
        showError("loginErr", "Introduce email y contrase√±a.");
        return;
      }

      try{
        const body = new URLSearchParams({ email, password });
        const resp = await fetch(`${API_URL}/login`, { method: "POST", body, mode: "cors" });
        const data = await resp.json();
        if (resp.ok) {
          setCurrentUser(data.user);
          alert("Sesi√≥n iniciada correctamente");
          window.location.href = "/";
        } else {
          showError("loginErr", data.error || "Error de inicio de sesi√≥n");
        }
      }catch(err){
        showError("loginErr", err.message || "Error de inicio de sesi√≥n");
      }
    });
  </script>
</body>
</html>
