<!doctype html>
<html lang="es">
<head>
  <!-- Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DYZ3GCXHEK"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments)}; gtag('js', new Date()); gtag('config','G-DYZ3GCXHEK');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ITHub Â· Arena de Certificaciones â€” Juega, sube de nivel y aprueba (AZ-104, AZ-305, SAA-C03)</title>
  <meta name="description" content="Una portada 100% gamificada: misiones, rachas, giro diario, jefes (simuladores), XP, monedas y marcador global. Juega y aprende para aprobar tus certificaciones IT.">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://ithub.es/">

  <!-- Favicon minimal neon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;utf8,
  <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>
    <defs><radialGradient id='g' cx='32' cy='32' r='32'><stop offset='0' stop-color='%2300f0ff'/><stop offset='1' stop-color='%23121428'/></radialGradient></defs>
    <rect width='64' height='64' rx='12' fill='url(%23g)'/>
    <text x='50%' y='58%' text-anchor='middle' font-size='28' font-family='monospace' font-weight='700' fill='%23fff'>IT</text>
  </svg>">

  <style>
    :root{
      --bg:#0b0f1c;
      --bg-2:#0a0e1b;
      --ink:#eef1ff;
      --muted:#9cb3ff;
      --accent:#00f0ff;
      --accent-2:#7a5bff;
      --accent-3:#ff6bd6;
      --good:#39e58c;
      --warn:#ffed66;
      --bad:#ff6270;
      --card:#101631;
      --card-2:#0f1430;
      --ring:#26306a;
      --radius:16px;
      --shadow:0 20px 48px rgba(0, 8, 40, .45);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font:16px/1.55 Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      overflow-x:hidden;
    }
    a{color:inherit; text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:0 18px}

    /* ====== UNIVERSO NEON (fondo animado + estrellas) ====== */
    .space{
      position:fixed; inset:0; z-index:-2;
      background:
        radial-gradient(1000px 600px at 10% -10%, rgba(0,240,255,.16), transparent 60%),
        radial-gradient(900px 520px at 110% 10%, rgba(122,91,255,.16), transparent 70%),
        radial-gradient(1200px 680px at 30% 110%, rgba(255,107,214,.12), transparent 70%),
        linear-gradient(180deg, var(--bg-2), var(--bg));
    }
    .grid-stars{
      position:fixed; inset:0; z-index:-1; pointer-events:none; opacity:.4;
      background:
        radial-gradient(1px 1px at 12% 22%, #cbe4ff, transparent),
        radial-gradient(1px 1px at 44% 66%, #cbe4ff, transparent),
        radial-gradient(1px 1px at 78% 12%, #cbe4ff, transparent),
        radial-gradient(2px 2px at 6% 80%, #fff, transparent),
        radial-gradient(2px 2px at 92% 48%, #fff, transparent);
      animation: twinkle 8s linear infinite;
    }
    @keyframes twinkle{
      0%,100%{opacity:.35} 50%{opacity:.6}
    }

    /* ====== NAVBAR HUD ====== */
    header{
      position:sticky; top:0; z-index:50; backdrop-filter:blur(10px);
      background:linear-gradient(180deg, rgba(9,12,28,.75), rgba(9,12,28,.35));
      border-bottom:1px solid var(--ring);
    }
    .hud{
      display:grid; grid-template-columns:auto 1fr auto; gap:14px; align-items:center; height:74px;
    }
    .brand{display:flex; gap:10px; align-items:center; font-weight:1000; letter-spacing:.3px}
    .brand img{height:38px}
    .nav{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:center;
    }
    .tab{
      display:inline-flex; align-items:center; gap:8px;
      height:40px; padding:0 14px; border-radius:999px;
      border:1px solid var(--ring); background:linear-gradient(180deg,#0c1230,#0b1027);
      color:var(--muted); font-weight:900; text-transform:uppercase; letter-spacing:.4px;
    }
    .tab:hover{color:#fff; border-color:#3950ff}
    .stats{
      display:flex; gap:10px; align-items:center;
      background:linear-gradient(180deg,#0c1230,#0b1027); border:1px solid var(--ring);
      border-radius:999px; padding:6px 10px;
    }
    .chip{display:inline-flex; align-items:center; gap:6px; font-weight:900; padding:6px 10px; border-radius:999px; background:#0e1536; border:1px solid #293376}
    .chip span{opacity:.85}
    .btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; height:40px; padding:0 14px; border-radius:12px;
      border:1px solid var(--ring); background:linear-gradient(180deg,#15205b,#0e1642); color:#fff; font-weight:900; text-transform:uppercase}
    .btn:hover{border-color:#5a73ff; transform:translateY(-1px)}

    /* ====== HERO ARENA ====== */
    .hero{
      padding:26px 0 10px; text-align:center;
    }
    .hero h1{
      margin:0; font-size:clamp(1.9rem, 4.6vw, 3.1rem); line-height:1.15; font-weight:1000;
      background:linear-gradient(90deg, #a7e0ff, #e5d3ff, #ffc9f0);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow: 0 0 24px rgba(122,91,255,.25);
    }
    .lead{color:var(--muted); max-width:980px; margin:8px auto 0}
    .hero-actions{display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:12px}
    .cta{
      background:linear-gradient(180deg, #00f0ff, #6bbcff);
      color:#00111a; border:1px solid #8be9ff; box-shadow:0 12px 28px rgba(0,240,255,.2);
    }
    .cta:hover{filter:saturate(1.1); box-shadow:0 18px 36px rgba(0,240,255,.28)}

    /* ====== ZONA PRINCIPAL: 3 columnas responsive ====== */
    section{padding:26px 0}
    .grid{display:grid; gap:14px}
    @media(min-width:900px){ .grid.cols-3{grid-template-columns:1.2fr 1fr 1fr} }
    @media(min-width:1000px){ .grid.cols-4{grid-template-columns:repeat(4,1fr)} }
    .card{
      background:linear-gradient(180deg, #0d1434, #0c122f);
      border:1px solid var(--ring); border-radius:var(--radius); box-shadow:var(--shadow); position:relative;
      padding:16px;
    }
    .card .head{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px}
    .tag{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; font-weight:900; border:1px solid #334089; color:#cfe2ff; background:linear-gradient(180deg,#101943,#0f1738)}
    .meter{height:10px; border-radius:999px; background:#09102a; border:1px solid var(--ring); overflow:hidden}
    .meter>span{display:block; height:100%; width:0; background:linear-gradient(90deg,#39e58c,#7affb8)}

    /* ====== MAPA DE MISIONES (carrusel) ====== */
    .map{
      display:grid; grid-template-columns:repeat(6,180px); gap:14px; overflow:auto; padding-bottom:4px; scroll-snap-type:x mandatory;
    }
    .node{
      scroll-snap-align:center;
      position:relative; padding:14px; min-height:140px; border-radius:14px;
      background:radial-gradient(260px 160px at 40% -10%, rgba(0,240,255,.16), transparent 60%), #10163a;
      border:1px solid #2a387a;
    }
    .node h4{margin:6px 0 4px}
    .node .row{display:flex; gap:8px; flex-wrap:wrap}
    .badge{display:inline-flex; align-items:center; gap:6px; padding:6px 8px; border-radius:999px; font-weight:900; background:#0e1847; border:1px solid #334089}
    .node .start{margin-top:8px}

    /* ====== QUIZ RÃPIDO (arena) ====== */
    .arena .q{
      background:linear-gradient(180deg,#0f193f,#0b1437);
      border:1px solid #2a387a; border-radius:14px; padding:12px; margin:8px 0;
    }
    .opt{
      display:grid; grid-template-columns:auto 1fr; gap:10px; align-items:start; margin:8px 0; padding:12px;
      border:1px solid #2a387a; border-radius:12px; background:linear-gradient(180deg,#0e163a,#0d1434);
      cursor:pointer; transition:.15s;
    }
    .opt:hover{border-color:#4b63ff}
    .opt.correct{border-color:#3bdc8a; background:linear-gradient(180deg,#0e1f3a,#0e1f3a)}
    .opt.wrong{border-color:#ff6474; background:linear-gradient(180deg,#2a0f1b,#2a0f1b)}
    .q-meta{display:flex; justify-content:space-between; color:#b9c9ff; font-weight:800}

    /* ====== MODALES ====== */
    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:120; background:rgba(2,6,18,.6); padding:16px}
    .modal.show{display:flex}
    .modal-card{width:min(880px,100%); background:linear-gradient(180deg,#0f1637,#0d1431); border:1px solid var(--ring); border-radius:16px; padding:18px; box-shadow:var(--shadow)}
    .modal h3{margin:0 0 12px}

    /* ====== BOTONES ESPECIALES ====== */
    .btn-ghost{background:transparent; border-color:#3b4aa6; color:#cfe2ff}
    .btn-win{background:linear-gradient(180deg,#39e58c,#18b86a); border-color:#4df0a0; color:#00140a}
    .btn-danger{background:linear-gradient(180deg,#ff6474,#ff5270); border-color:#ff93a2}

    /* ====== DETALLES ====== */
    .hint{color:#b9c9ff}
    .spark{
      position:absolute; inset:-1px; border-radius:inherit; pointer-events:none;
      background: conic-gradient(from 0deg at 50% 50%, rgba(0,240,255,.22), rgba(122,91,255,.12), rgba(255,107,214,.14), rgba(0,240,255,.22));
      filter:blur(12px); opacity:.3; mix-blend-mode:screen;
      animation: spin 6s linear infinite;
    }
    @keyframes spin{ to{ transform:rotate(360deg) } }

    /* ====== FOOTER ====== */
    footer{border-top:1px solid var(--ring); padding:24px 0; color:#b9c9ff}
    .fcols{display:grid; gap:14px}
    @media(min-width:860px){ .fcols{grid-template-columns:1.2fr .8fr .8fr .8fr} }
    footer a:hover{text-decoration:underline}

    /* A11y */
    .skip{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;}
    .skip:focus{position:fixed;left:12px;top:12px;background:#fff;color:#111;padding:10px 14px;border-radius:10px;z-index:9999;}
  </style>
</head>
<body>
  <div class="space" aria-hidden="true"></div>
  <div class="grid-stars" aria-hidden="true"></div>

  <a class="skip" href="#main">Saltar al contenido principal</a>

  <!-- HUD -->
  <header role="banner">
    <div class="container hud">
      <div class="brand">
        <img src="/assets/ithub-logo.svg" alt="ITHub">
        <div style="font-weight:1000">Arena de Certificaciones</div>
      </div>

      <nav class="nav" aria-label="Principal">
        <a class="tab" href="#mapa">ğŸ—ºï¸ Mapa</a>
        <a class="tab" href="#arena">âš”ï¸ Arena</a>
        <a class="tab" href="/score/ranking.html">ğŸ† Ranking</a>
        <a class="tab" href="#faq">â“ FAQ</a>
      </nav>

      <div class="stats" aria-label="Panel de jugador">
        <div class="chip">ğŸ§© <span id="lvl">Lv.1</span></div>
        <div class="chip">ğŸ’ <span id="coins">0</span></div>
        <div class="chip">ğŸ”¥ <span id="streak">0</span>d</div>
        <a id="btnLogin" class="btn-ghost btn" href="/login/login.html">Login</a>
        <a id="btnSignup" class="btn btn" href="/login/login.html#signup">Crear cuenta</a>
        <div id="userArea" style="display:none;gap:8px;align-items:center">
          <span class="chip">ğŸ‘‹ <b id="nick">USER</b></span>
          <a class="btn-ghost btn" href="/user/profile.html">Perfil</a>
          <button id="btnLogout" class="btn-danger btn" type="button">Salir</button>
        </div>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero" aria-labelledby="hero-title">
    <div class="container">
      <h1 id="hero-title">Juega para aprender. Aprende para ganar tu certificaciÃ³n.</h1>
      <p class="lead">Completa misiones, mantÃ©n tu racha, gira la ruleta diaria y enfrÃ©ntate a los <b>Jefes</b> (simuladores oficiales). Cada acierto suma <b>XP</b> y <b>monedas</b> para subir de nivel.</p>
      <div class="hero-actions" role="group">
        <a class="btn cta" href="#arena">Entrar a la Arena</a>
        <a class="btn" href="/score/ranking.html">Ver Ranking</a>
        <button id="dailySpinBtn" class="btn-ghost btn" type="button">ğŸ° Giro diario</button>
      </div>
    </div>
  </section>

  <main id="main">
    <!-- ZONA de 3 columnas: Mapa, Arena, Objetivos -->
    <section class="container">
      <div class="grid cols-3">
        <!-- MAPA DE MISIONES -->
        <article class="card" id="mapa" aria-labelledby="map-title">
          <div class="spark" aria-hidden="true"></div>
          <div class="head">
            <div class="tag" id="map-title">ğŸ—ºï¸ Mapa de Misiones</div>
            <div class="hint">Completa nodos para ganar XP</div>
          </div>
          <div class="map" id="mapGrid" role="list"></div>
        </article>

        <!-- ARENA (PREGUNTA RÃPIDA) -->
        <article class="card arena" id="arena" aria-labelledby="arena-title">
          <div class="spark" aria-hidden="true"></div>
          <div class="head">
            <div class="tag" id="arena-title">âš”ï¸ Arena â€” Pregunta rÃ¡pida</div>
            <div class="hint">+5 XP por acierto, +1 moneda</div>
          </div>
          <div class="q-meta">
            <div>Pregunta <span id="aIdx">1</span>/<span id="aTot">1</span> Â· <span id="aDomain"></span></div>
            <div id="aExam">AZ-104</div>
          </div>
          <div class="q">
            <div id="aTitle" style="font-weight:900">Cargandoâ€¦</div>
            <div id="aOptions"></div>
          </div>
          <div style="display:flex;gap:8px;justify-content:space-between">
            <button id="btnNewQ" class="btn-ghost btn" type="button">Otra pregunta</button>
            <button id="btnDiag" class="btn btn" type="button">ğŸ§­ Mini-diagnÃ³stico</button>
          </div>
        </article>

        <!-- OBJETIVOS / PROGRESO -->
        <article class="card" aria-labelledby="goals-title">
          <div class="spark" aria-hidden="true"></div>
          <div class="head">
            <div class="tag" id="goals-title">ğŸ¯ Objetivo semanal</div>
            <div class="hint">70 preguntas/semana</div>
          </div>
          <div class="meter" style="margin-top:4px"><span id="wbar"></span></div>
          <div style="display:flex;align-items:center;gap:10px;margin-top:8px">
            <div class="chip">ğŸ“ˆ <b id="wVal">0</b>/70</div>
            <button id="add5" class="btn-ghost btn" type="button">+5</button>
            <button id="resetW" class="btn-danger btn" type="button">Reset</button>
          </div>
          <hr style="border:0;border-top:1px solid var(--ring);margin:12px 0">
          <div class="head">
            <div class="tag">ğŸ‘‘ Jefes de CertificaciÃ³n</div>
            <a class="btn-ghost btn" href="/score/ranking.html">Ranking â†’</a>
          </div>
          <div id="bossList" class="grid" style="grid-template-columns:1fr; gap:10px"></div>
        </article>
      </div>
    </section>

    <!-- CONTENIDOS RECIENTES -->
    <section class="container">
      <article class="card">
        <div class="head">
          <div class="tag">ğŸ“š Ãšltimos contenidos</div>
          <div class="hint">ResÃºmenes y hojas de trucos</div>
        </div>
        <div class="grid cols-4" id="contentGrid"></div>
      </article>
    </section>

    <!-- FAQ -->
    <section class="container" id="faq">
      <article class="card">
        <div class="head">
          <div class="tag">â“ FAQ</div>
        </div>
        <details class="card" style="padding:12px;margin:0">
          <summary style="cursor:pointer;font-weight:900">Â¿CÃ³mo funciona la racha?</summary>
          <p class="hint">Te conectas un dÃ­a â†’ +1. Si vuelves al dÃ­a siguiente, se mantiene. Si fallas un dÃ­a, se reinicia.</p>
        </details>
        <details class="card" style="padding:12px;margin-top:10px">
          <summary style="cursor:pointer;font-weight:900">Â¿QuÃ© es un Jefe?</summary>
          <p class="hint">Un simulador cronometrado con explicaciÃ³n y enlaces oficiales. Vence al jefe para ganar muchas monedas.</p>
        </details>
      </article>
    </section>
  </main>

  <!-- FOOTER -->
  <footer role="contentinfo">
    <div class="container fcols">
      <div>
        <div style="font-weight:1000">ITHUB.ES</div>
        <p>Una plataforma para convertir el estudio en un juego serio. Practica, compite y aprueba.</p>
        <button id="footerContactBtn" class="btn-ghost btn">ğŸ’¬ Contacto</button>
        <div style="margin-top:8px;color:#9cb3ff">Â© <span id="y"></span> ITHub.es</div>
      </div>
      <div>
        <div class="tag">Simuladores</div>
        <p><a href="/certification/microsoft-azure/az-104/lz-azure-az-104.html">Azure AZ-104</a></p>
        <p><a href="/certification/microsoft-azure/az-305/lz-azure-az-305.html">Azure AZ-305</a></p>
        <p><a href="/certification/amazon aws/aws-saa-c03/lz-aws-saa-c03.html">AWS SAA-C03</a></p>
      </div>
      <div>
        <div class="tag">Destacados</div>
        <p><a href="/content/azure-identity-az104.html">Azure Â· Identidad</a></p>
        <p><a href="/content/azure-network-security-az104.html">Azure Â· Seguridad de red</a></p>
        <p><a href="/content/azure-cost-governance-az104.html">Azure Â· Coste & Gov</a></p>
        <p><a href="/content/aws-compute-elasticity-saac03.html">AWS Â· Elasticidad</a></p>
      </div>
      <div>
        <div class="tag">Colaboradores</div>
        <p><a href="https://mundoazure.cloud" rel="noopener" target="_blank">mundoazure.cloud</a></p>
      </div>
    </div>
  </footer>

  <!-- MODAL: DIAGNÃ“STICO -->
  <div class="modal" id="diagModal" role="dialog" aria-modal="true" aria-labelledby="diagTitle">
    <div class="modal-card">
      <h3 id="diagTitle">ğŸ§­ Mini-test diagnÃ³stico</h3>
      <div id="diagSetup">
        <div style="display:grid;grid-template-columns:1fr auto;gap:12px;align-items:end">
          <div>
            <label for="diagExam" style="font-weight:900">Examen</label>
            <select id="diagExam" style="width:100%;border:1px solid var(--ring);border-radius:10px;background:#0e1642;color:#fff;padding:10px;margin-top:6px">
              <option value="AZ-104">AZ-104 Â· Azure Administrator</option>
              <option value="AZ-305">AZ-305 Â· Azure Architect</option>
              <option value="SAA-C03">SAA-C03 Â· AWS Architect Associate</option>
            </select>
          </div>
          <label style="display:flex;gap:10px;align-items:center;color:#cfe2ff;font-weight:800">
            <input id="diagImmediate" type="checkbox"> CorrecciÃ³n inmediata
          </label>
        </div>
        <p class="hint">Se eligen 3 preguntas por dominio (4Ã—3). Resumen por dominios al final.</p>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn-ghost btn" id="btnCloseDiag1" type="button">Cancelar</button>
          <button class="btn btn" id="btnStartDiag" type="button">Comenzar (12)</button>
        </div>
      </div>

      <div id="diagQuiz" style="display:none">
        <div class="q-meta"><div>Pregunta <span id="dqIndex">1</span>/<span id="dqTotal">12</span> Â· <span id="dqDomain"></span></div><div id="dqNote"></div></div>
        <div class="arena">
          <div class="q">
            <div id="dqTitle" style="font-weight:900">...</div>
            <div id="dqOptions"></div>
          </div>
        </div>
        <div style="display:flex;gap:8px;justify-content:space-between">
          <button class="btn-ghost btn" id="btnPrevQ" type="button">â† Anterior</button>
          <button class="btn btn" id="btnNextQ" type="button">Siguiente â†’</button>
        </div>
      </div>

      <div id="diagResult" style="display:none">
        <h4>Resultados por dominios</h4>
        <div id="diagGridModal" class="grid" style="grid-template-columns:repeat(2,1fr);gap:10px"></div>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
          <button class="btn-ghost btn" id="btnCloseDiag2" type="button">Cerrar</button>
          <button class="btn btn" id="btnSaveDiag" type="button">Guardar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: FEEDBACK -->
  <div class="modal" id="feedbackModal" role="dialog" aria-modal="true" aria-labelledby="fbTitle">
    <div class="modal-card">
      <h3 id="fbTitle">ğŸ’¬ Enviar feedback</h3>
      <p class="hint">Â¿QuÃ© te gustarÃ­a mejorar o ver nuevo?</p>
      <input id="feedbackEmail" type="email" placeholder="Tu email (opcional)" style="width:100%;border:1px solid var(--ring);border-radius:10px;background:#0e1642;color:#fff;padding:10px;margin:6px 0">
      <textarea id="feedbackText" placeholder="Escribe tu sugerenciaâ€¦" style="width:100%;border:1px solid var(--ring);border-radius:10px;background:#0e1642;color:#fff;padding:10px;min-height:120px"></textarea>
      <div id="fbStatus" class="hint" aria-live="polite"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
        <button class="btn-ghost btn" id="btnCancelFeedback" type="button">Cancelar</button>
        <button class="btn btn" id="btnSendFeedback" type="button">Enviar</button>
        <button class="btn btn-win" id="btnOkFeedback" type="button" style="display:none">Aceptar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: GIRO DIARIO -->
  <div class="modal" id="spinModal" role="dialog" aria-modal="true" aria-labelledby="spinTitle">
    <div class="modal-card" style="max-width:520px">
      <h3 id="spinTitle">ğŸ° Ruleta diaria</h3>
      <p class="hint">Â¡Una vez al dÃ­a! Gana monedas y XP extra.</p>
      <div id="spinWheel" class="card" style="height:180px; display:grid; place-items:center; font-size:34px; font-weight:1000; letter-spacing:1px">Listo</div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
        <button id="spinGo" class="btn btn">Girar</button>
        <button id="spinClose" class="btn-ghost btn">Cerrar</button>
      </div>
    </div>
  </div>

  <script>
    /* === Helpers / Estado jugador === */
    const $ = s => document.querySelector(s);
    const state = {
      coins: Number(localStorage.getItem('game_coins')||'0'),
      xp: Number(localStorage.getItem('game_xp')||'0'),
      level: Number(localStorage.getItem('game_level')||'1'),
      weekly: Number(localStorage.getItem('game_weekly')||'0'),
      lastSpin: localStorage.getItem('game_lastSpin')||'',
    };
    function save(){ localStorage.setItem('game_coins',state.coins); localStorage.setItem('game_xp',state.xp); localStorage.setItem('game_level',state.level); localStorage.setItem('game_weekly',state.weekly); }
    function addXP(n){ state.xp+=n; while(state.xp >= state.level*20){ state.xp-=state.level*20; state.level++; ping('Â¡Subes a nivel '+state.level+'!'); } save(); updateHUD(); }
    function addCoins(n){ state.coins+=n; save(); updateHUD(); }
    function updateHUD(){
      $('#coins').textContent = state.coins;
      $('#lvl').textContent = 'Lv.'+state.level;
    }

    /* === AÃ±o, login UI === */
    $('#y').textContent = new Date().getFullYear();
    function getUser(){ try{ return JSON.parse(localStorage.getItem('currentUser')||'null'); }catch{ return null; } }
    function renderAuth(){
      const u=getUser();
      if(u){ $('#btnLogin').style.display='none'; $('#btnSignup').style.display='none'; $('#userArea').style.display='flex'; $('#nick').textContent=(u.name||u.email||'USER').toUpperCase(); }
      else{ $('#btnLogin').style.display='inline-flex'; $('#btnSignup').style.display='inline-flex'; $('#userArea').style.display='none'; }
    }
    $('#btnLogout')?.addEventListener('click',()=>{ localStorage.removeItem('currentUser'); renderAuth(); });
    renderAuth(); updateHUD();

    /* === Racha diaria === */
    (function streak(){
      const KS='game_streak';
      const d=new Date(); d.setHours(0,0,0,0); const today=d.getTime();
      let s=JSON.parse(localStorage.getItem(KS)||'{"days":0,"last":0}');
      if(s.last!==today){ s.days = (s.last===today-86400000) ? s.days+1 : 1; s.last=today; localStorage.setItem(KS, JSON.stringify(s)); }
      $('#streak').textContent = s.days+'d';
    })();

    /* === Objetivo semanal === */
    function renderWeekly(){
      const pct=Math.min(100, Math.round(state.weekly/70*100));
      $('#wVal').textContent = state.weekly;
      $('#wbar').style.width = pct+'%';
    }
    $('#add5').addEventListener('click', ()=>{ state.weekly=Math.min(70, state.weekly+5); save(); renderWeekly(); if(state.weekly===70) celebrate(); });
    $('#resetW').addEventListener('click', ()=>{ state.weekly=0; save(); renderWeekly(); });
    renderWeekly();

    /* === Contenidos destacados === */
    const CONTENTS = [
      { t:'Azure Â· Identidad y Acceso', url:'/content/azure-identity-az104.html' },
      { t:'Azure Â· Seguridad en la red', url:'/content/azure-network-security-az104.html' },
      { t:'Azure Â· Coste y Gobernanza', url:'/content/azure-cost-governance-az104.html' },
      { t:'Azure Â· Landing Zone', url:'/content/azure-landing-zone.html' },
      { t:'AWS Â· Elasticidad EC2', url:'/content/aws-compute-elasticity-saac03.html' },
    ];
    function renderContents(){
      const box=$('#contentGrid'); box.innerHTML='';
      CONTENTS.slice(0,4).forEach(c=>{
        const el=document.createElement('a');
        el.href=c.url; el.className='card'; el.style.padding='14px';
        el.innerHTML=`<div class="tag">Nuevo</div><h4 style="margin:8px 0 0">${c.t}</h4>`;
        box.appendChild(el);
      });
    }
    renderContents();

    /* === Jefes / Simuladores === */
    const BOSSES = [
      { id:'AZ-104', title:'Azure Administrator', url:'/certification/microsoft-azure/az-104/lz-azure-az-104.html', tag:'AZURE' },
      { id:'AZ-305', title:'Azure Architect',     url:'/certification/microsoft-azure/az-305/lz-azure-az-305.html', tag:'AZURE' },
      { id:'SAA-C03', title:'AWS Architect',      url:'/certification/amazon aws/aws-saa-c03/lz-aws-saa-c03.html', tag:'AWS' }
    ];
    function renderBosses(){
      const box=$('#bossList'); box.innerHTML='';
      BOSSES.forEach(b=>{
        const card=document.createElement('div'); card.className='card'; card.style.padding='12px';
        card.innerHTML=`<div class="tag">${b.tag} Â· ${b.id}</div><h4 style="margin:6px 0">${b.title}</h4>
                        <div style="display:flex;gap:8px">
                          <a class="btn-ghost btn" href="/score/ranking.html?quiz=${b.id.toLowerCase()}">ğŸ† Ranking</a>
                          <a class="btn" href="${b.url}">â–¶ Empezar</a>
                        </div>`;
        box.appendChild(card);
      });
    }
    renderBosses();

    /* === Mapa de misiones (nodos con mini-retos) === */
    const MISSIONS = [
      { id:'m1', label:'Warm-up AZ-104', exam:'AZ-104', reward:{xp:8, coins:2} },
      { id:'m2', label:'Network Core',   exam:'AZ-104', reward:{xp:10, coins:3} },
      { id:'m3', label:'Storage Rules',  exam:'AZ-104', reward:{xp:10, coins:3} },
      { id:'m4', label:'Design Pillars', exam:'AZ-305', reward:{xp:12, coins:4} },
      { id:'m5', label:'Front Doors',    exam:'AZ-305', reward:{xp:12, coins:4} },
      { id:'m6', label:'AWS Basics',     exam:'SAA-C03', reward:{xp:8, coins:2} },
      { id:'m7', label:'HA on AWS',      exam:'SAA-C03', reward:{xp:12, coins:4} },
    ];
    function renderMap(){
      const map=$('#mapGrid'); map.innerHTML='';
      MISSIONS.forEach(ms=>{
        const n=document.createElement('div'); n.className='node'; n.setAttribute('role','listitem');
        n.innerHTML = `
          <div class="row">
            <div class="badge">ğŸ¯ ${ms.exam}</div>
            <div class="badge">+${ms.reward.xp} XP</div>
            <div class="badge">+${ms.reward.coins} ğŸ’</div>
          </div>
          <h4>${ms.label}</h4>
          <div class="hint">Reto relÃ¡mpago: 1 pregunta</div>
          <div class="row start">
            <button class="btn" data-m="${ms.id}">Jugar</button>
          </div>
        `;
        map.appendChild(n);
      });
      map.addEventListener('click', e=>{
        const b=e.target.closest('button[data-m]'); if(!b) return;
        const id=b.dataset.m; const ms=MISSIONS.find(x=>x.id===id);
        if(ms){ serveQuickQuestion(ms.exam, ()=>{ addXP(ms.reward.xp); addCoins(ms.reward.coins); ping(`+${ms.reward.xp} XP Â· +${ms.reward.coins}ğŸ’`); }); }
      });
    }
    renderMap();

    /* === Arena: banco de preguntas === */
    const BANK = [
      // AZ-104
      { exam:"AZ-104", domain:"Identidades", q:"Â¿QuÃ© servicio centraliza reglas de acceso a nivel de suscripciÃ³n y grupos de recursos?", options:["Azure Policy","Azure Blueprints","RBAC (roles)","Privileged Identity Management"], answerIndex:2 },
      { exam:"AZ-104", domain:"Almacenamiento", q:"Â¿QuÃ© opciÃ³n asegura WORM legalmente inmutable?", options:["Soft delete","Versioning","Immutable Blob (Time-based)","Geo-Redundancy"], answerIndex:2 },
      { exam:"AZ-104", domain:"Red", q:"Web multizona + TLS + WAF gestionado:", options:["Traffic Manager","Application Gateway","Front Door","Load Balancer"], answerIndex:2 },
      // AZ-305
      { exam:"AZ-305", domain:"Red", q:"Global L7 + WAF + TLS + enrutamiento cercano:", options:["Traffic Manager","Azure Front Door (Std/Prem)","Application Gateway","Load Balancer"], answerIndex:1 },
      { exam:"AZ-305", domain:"Datos", q:"DB global, latencia ms y multi-master:", options:["SQL MI","Cosmos DB","PostgreSQL Flex","SQL en VM"], answerIndex:1 },
      { exam:"AZ-305", domain:"Continuidad", q:"DR orquestado entre regiones con RPO minutos:", options:["Backup RSV","Traffic Manager","Availability Sets","Azure Site Recovery"], answerIndex:3 },
      // SAA-C03
      { exam:"SAA-C03", domain:"Seguro", q:"Acceso a S3 sin Internet desde VPC:", options:["Gateway Endpoint","Interface Endpoint","NAT Gateway","Internet Gateway"], answerIndex:0 },
      { exam:"SAA-C03", domain:"Rendimiento", q:"Bajo ms, millones RPS y esquema flexible:", options:["RDS MySQL","DynamoDB","Aurora PostgreSQL","Neptune"], answerIndex:1 },
      { exam:"SAA-C03", domain:"HA", q:"Publicar eventos a muchos consumidores:", options:["FIFO queue","SNS fanout","S3 event bridge","Kinesis Firehose"], answerIndex:1 }
    ];

    /* === Arena: pregunta rÃ¡pida === */
    function rnd(arr){ return arr[Math.floor(Math.random()*arr.length)] }
    function drawQuestion(exam){
      const pool = exam ? BANK.filter(x=>x.exam===exam) : BANK;
      return rnd(pool);
    }
    function renderArena(q, onAnswered){
      $('#aDomain').textContent = q.domain;
      $('#aExam').textContent   = q.exam;
      $('#aTitle').textContent  = q.q;
      const box = $('#aOptions'); box.innerHTML='';
      q.options.forEach((t,i)=>{
        const el=document.createElement('label'); el.className='opt';
        el.innerHTML = `<input type="radio" name="arena" value="${i}"><span>${t}</span>`;
        box.appendChild(el);
      });
      box.addEventListener('change', e=>{
        const v=Number(e.target.value);
        [...box.querySelectorAll('.opt')].forEach((l,ii)=>{ l.classList.remove('correct','wrong'); if(ii===q.answerIndex) l.classList.add('correct'); if(ii===v && ii!==q.answerIndex) l.classList.add('wrong'); });
        if(v===q.answerIndex){ addXP(5); addCoins(1); state.weekly=Math.min(70,state.weekly+1); save(); renderWeekly(); ping('+5 XP Â· +1ğŸ’'); }
        if(onAnswered) onAnswered(v===q.answerIndex);
      }, { once:true });
    }
    function serveQuickQuestion(exam, afterWin){
      const q = drawQuestion(exam);
      renderArena(q, (ok)=>{ if(ok && afterWin) { afterWin(); } });
      $('#aTot').textContent = '1';
      $('#aIdx').textContent = '1';
      window.scrollTo({ top: $('#arena').getBoundingClientRect().top + window.scrollY - 90, behavior:'smooth' });
    }
    // primera carga
    renderArena(drawQuestion(), null);
    $('#btnNewQ').addEventListener('click', ()=> renderArena(drawQuestion(), null));

    /* === Mini-diagnÃ³stico (12 preguntas) === */
    const DIAG = [
      // AZ-104
      { exam:"AZ-104", domain:"Identidades", q:"Reglas de acceso centralizadas:", options:["Azure Policy","Blueprints","RBAC","PIM"], answerIndex:2 },
      { exam:"AZ-104", domain:"Identidades", q:"Permisos temporales con aprobaciÃ³n:", options:["Access Reviews","PIM","Conditional Access","User Access Admin"], answerIndex:1 },
      { exam:"AZ-104", domain:"Almacenamiento", q:"WORM legal:", options:["Soft delete","Versioning","Immutable Blob (Time-based)","GRS"], answerIndex:2 },
      { exam:"AZ-104", domain:"Red", q:"SLA con BGP:", options:["S2S","P2S","ExpressRoute","Peering"], answerIndex:2 },
      // AZ-305
      { exam:"AZ-305", domain:"Red", q:"Hub-and-spoke con salida inspeccionada:", options:["Peering malla","Virtual WAN Hub seguro","App GW por spoke","NVA por spoke"], answerIndex:1 },
      { exam:"AZ-305", domain:"Datos", q:"Data Lake con ACL POSIX:", options:["Azure Files","ADLS Gen2","Managed Disks","Queue"], answerIndex:1 },
      { exam:"AZ-305", domain:"Seguridad", q:"Secretos/keys HSM + purge:", options:["KV Premium","App Config","Managed Identity","KV Standard"], answerIndex:0 },
      { exam:"AZ-305", domain:"Continuidad", q:"DR orquestado RPO minutos:", options:["Backup","TM","AS","ASR"], answerIndex:3 },
      // SAA-C03
      { exam:"SAA-C03", domain:"Seguro", q:"S3 sin Internet:", options:["Gateway EP","Interface EP","NAT","IGW"], answerIndex:0 },
      { exam:"SAA-C03", domain:"Rendimiento", q:"Millones RPS:", options:["RDS","DynamoDB","Aurora","Neptune"], answerIndex:1 },
      { exam:"SAA-C03", domain:"HA", q:"Fanout:", options:["FIFO","SNS","S3 event","Firehose"], answerIndex:1 },
      { exam:"SAA-C03", domain:"Coste", q:"Batch oportunista:", options:["On-Demand","Savings","Spot","Dedicated"], answerIndex:2 }
    ];
    function pick12(exam){
      const groups={
        "AZ-104":["Identidades","Almacenamiento","Red"],
        "AZ-305":["Red","Datos","Seguridad","Continuidad"],
        "SAA-C03":["Seguro","Rendimiento","HA","Coste"]
      }[exam];
      const pool=DIAG.filter(x=>x.exam===exam); const out=[];
      groups.forEach(g=>{
        const sub=pool.filter(x=>x.domain===g);
        for(let i=0;i<3 && i<sub.length;i++) out.push(sub[i]);
      });
      return out.slice(0,12);
    }

    const diagModal = $('#diagModal');
    function openDiag(){
      $('#diagSetup').style.display='block';
      $('#diagQuiz').style.display='none';
      $('#diagResult').style.display='none';
      diagModal.classList.add('show');
    }
    $('#btnDiag').addEventListener('click', openDiag);
    $('#btnCloseDiag1').addEventListener('click', ()=> diagModal.classList.remove('show'));
    $('#btnCloseDiag2').addEventListener('click', ()=> diagModal.classList.remove('show'));
    diagModal.addEventListener('click', e=>{ if(e.target===diagModal) diagModal.classList.remove('show'); });

    let session={ exam:"AZ-104", immediate:false, questions:[], answers:[], i:0 };
    const dqIndex=$('#dqIndex'), dqTotal=$('#dqTotal'), dqTitle=$('#dqTitle'),
          dqOptions=$('#dqOptions'), dqDomain=$('#dqDomain'), dqNote=$('#dqNote'),
          btnPrevQ=$('#btnPrevQ'), btnNextQ=$('#btnNextQ');

    $('#btnStartDiag').addEventListener('click', ()=>{
      const exam=$('#diagExam').value; const imm=$('#diagImmediate').checked;
      session={ exam, immediate:imm, questions:pick12(exam), answers:[], i:0 };
      dqTotal.textContent=session.questions.length; renderDiagQ(); $('#diagSetup').style.display='none'; $('#diagQuiz').style.display='block';
    });
    function renderDiagQ(){
      const q=session.questions[session.i]; dqIndex.textContent=session.i+1; dqTitle.textContent=q.q; dqDomain.textContent=q.domain; dqOptions.innerHTML='';
      q.options.forEach((t,idx)=>{ const w=document.createElement('label'); w.className='opt'; w.innerHTML=`<input type="radio" name="dq${session.i}" value="${idx}"><span>${t}</span>`; dqOptions.appendChild(w); });
      dqNote.textContent = session.immediate ? 'Se corrige al seleccionar.' : '';
      [...dqOptions.querySelectorAll('input')].forEach(inp=>{
        inp.addEventListener('change',()=>{
          const chosen=Number(inp.value); session.answers[session.i]=chosen;
          if(session.immediate){ styleImmediate(chosen, q.answerIndex); }
        });
      });
      btnPrevQ.disabled = session.i===0;
      btnNextQ.textContent = (session.i===session.questions.length-1) ? 'Finalizar' : 'Siguiente â†’';
    }
    function styleImmediate(sel, cor){
      const labs=[...dqOptions.querySelectorAll('.opt')];
      labs.forEach((l,i)=>{ l.classList.remove('correct','wrong'); if(i===cor) l.classList.add('correct'); if(i===sel && i!==cor) l.classList.add('wrong'); });
    }
    btnPrevQ.addEventListener('click', ()=>{ if(session.i>0){ session.i--; renderDiagQ(); }});
    btnNextQ.addEventListener('click', ()=>{
      if(session.answers[session.i]==null){ if(!confirm('No has respondido. Â¿Continuar?')) return; }
      if(session.i<session.questions.length-1){ session.i++; renderDiagQ(); }
      else{ finishDiag(); }
    });
    function finishDiag(){
      const byDomain={}; let score=0;
      session.questions.forEach((q,i)=>{ const d=q.domain; if(!byDomain[d]) byDomain[d]={c:0,t:0}; byDomain[d].t++; if(session.answers[i]===q.answerIndex){ byDomain[d].c++; score++; } });
      const result={ exam:session.exam, byDomain, when:Date.now(), score };
      $('#diagQuiz').style.display='none'; $('#diagResult').style.display='block';
      const grid=$('#diagGridModal'); grid.innerHTML='';
      Object.entries(byDomain).forEach(([dom,st])=>{
        const p=Math.round(st.c/st.t*100);
        const card=document.createElement('div'); card.className='card'; card.style.padding='12px';
        card.innerHTML=`<div class="tag">${dom}</div><div class="meter" style="margin-top:6px"><span style="width:${p}%; background:${p<50?'linear-gradient(90deg,#ff6474,#ff9ba6)':'linear-gradient(90deg,#39e58c,#7affb8)'}"></span></div><div class="hint" style="margin-top:6px">${st.c}/${st.t} Â· ${p}%</div>`;
        grid.appendChild(card);
      });
      // recompensa simple por terminar
      addXP(10); addCoins(3); ping('Â¡DiagnÃ³stico completado! +10 XP Â· +3ğŸ’');
      $('#btnSaveDiag').onclick=()=>{ saveDiag(result); alert('Guardado local.'); };
    }
    function saveDiag(r){ const key='diagnosticResults'; localStorage.setItem(key, JSON.stringify(r)); }

    /* === Daily Spin === */
    const spinModal=$('#spinModal'); const spinBtn=$('#dailySpinBtn'); const spinGo=$('#spinGo'); const spinWheel=$('#spinWheel');
    spinBtn.addEventListener('click', ()=>{
      spinModal.classList.add('show');
      spinWheel.textContent='Listo';
    });
    $('#spinClose').addEventListener('click', ()=> spinModal.classList.remove('show'));
    spinModal.addEventListener('click', e=>{ if(e.target===spinModal) spinModal.classList.remove('show'); });
    spinGo.addEventListener('click', ()=>{
      const today = new Date().toISOString().slice(0,10);
      if(state.lastSpin===today){ spinWheel.textContent='â³ MaÃ±ana de nuevo'; return; }
      const prizes = [
        { t:'+3 ğŸ’',  c:()=>addCoins(3) },
        { t:'+6 ğŸ’',  c:()=>addCoins(6) },
        { t:'+5 XP',  c:()=>addXP(5) },
        { t:'+10 XP', c:()=>addXP(10) },
        { t:'+2 ğŸ’ +5 XP', c:()=>{ addCoins(2); addXP(5); } },
      ];
      spinWheel.textContent='Girandoâ€¦';
      let i=0; const spin=setInterval(()=>{ spinWheel.textContent=prizes[i%prizes.length].t; i++; }, 80);
      setTimeout(()=>{ clearInterval(spin); const p=prizes[Math.floor(Math.random()*prizes.length)]; p.c(); spinWheel.textContent='ğŸ‰ '+p.t; state.lastSpin=today; localStorage.setItem('game_lastSpin', state.lastSpin); celebrate(); }, 1400);
    });

    /* === Feedback modal === */
    const fbModal=$('#feedbackModal');
    $('#footerContactBtn')?.addEventListener('click', ()=> fbModal.classList.add('show'));
    $('#btnCancelFeedback')?.addEventListener('click', ()=> fbModal.classList.remove('show'));
    fbModal?.addEventListener('click', e=>{ if(e.target===fbModal) fbModal.classList.remove('show'); });

    const API_BASE='https://uougu1cm26.execute-api.eu-central-1.amazonaws.com', NOTES_ENDPOINT=`${API_BASE}/items`;
    $('#btnSendFeedback')?.addEventListener('click', async ()=>{
      const email=($('#feedbackEmail').value||'').trim(), message=($('#feedbackText').value||'').trim(), out=$('#fbStatus');
      if(!message){ out.textContent='Escribe tu sugerencia.'; return; }
      out.textContent='Enviandoâ€¦';
      const id=(crypto&&crypto.randomUUID)?crypto.randomUUID():('note_'+Date.now());
      const u=getUser();
      const note={ id, type:'feedback', title:'Feedback ITHub', message, email:email || (u?.email||null), userId:u?.id||u?.email||null, path:location.pathname+location.search, ua:navigator.userAgent, createdAt:new Date().toISOString() };
      const params=new URLSearchParams(); params.set('table','notes'); params.set('id',id); params.set('content', JSON.stringify(note));
      const ctl=new AbortController(); const to=setTimeout(()=>ctl.abort(),10000);
      try{
        const res=await fetch(NOTES_ENDPOINT,{method:'POST', body:params, signal:ctl.signal}); clearTimeout(to);
        if(!res.ok) throw new Error(res.status);
        out.textContent='Â¡Gracias! Recibido ğŸ‘Œ'; $('#btnSendFeedback').style.display='none'; $('#btnCancelFeedback').style.display='none'; $('#btnOkFeedback').style.display='inline-flex';
        $('#btnOkFeedback').onclick=()=> fbModal.classList.remove('show');
      }catch(e){
        out.textContent='No se pudo enviar. Intenta mÃ¡s tarde.'; $('#btnSendFeedback').style.display='none'; $('#btnCancelFeedback').style.display='none'; $('#btnOkFeedback').style.display='inline-flex';
        $('#btnOkFeedback').onclick=()=> fbModal.classList.remove('show');
      }
    });

    /* === Micro-UX === */
    function ping(text){
      const n=document.createElement('div');
      n.textContent=text; n.style.cssText='position:fixed;left:50%;top:16px;transform:translateX(-50%);background:linear-gradient(180deg,#18256b,#111a4f);border:1px solid #3a49a6;padding:10px 14px;border-radius:10px;font-weight:900;box-shadow:var(--shadow);z-index:999;color:#e7eeff';
      document.body.appendChild(n);
      setTimeout(()=>{ n.style.transition='all .5s ease'; n.style.opacity='0'; n.style.transform='translateX(-50%) translateY(-16px)'; }, 1200);
      setTimeout(()=> n.remove(), 1900);
    }
    function celebrate(){
      const cv=document.createElement('canvas'); cv.style.cssText='position:fixed;inset:0;pointer-events:none;z-index:110;'; document.body.appendChild(cv);
      const ctx=cv.getContext('2d'); let w=cv.width=innerWidth, h=cv.height=innerHeight;
      const P=Array.from({length:130},()=>({x:Math.random()*w,y:-20-Math.random()*h,vx:(Math.random()-.5)*3,vy:2+Math.random()*4,s:6+Math.random()*6,c:Math.random()*360}));
      let t=0; (function loop(){ ctx.clearRect(0,0,w,h); t+=.02; for(const p of P){ p.vy+=.02; p.x+=p.vx; p.y+=p.vy; ctx.fillStyle=`hsl(${(p.c+t*180)%360} 90% 60%)`; ctx.fillRect(p.x,p.y,p.s,p.s); } if(t<3.2) requestAnimationFrame(loop); else cv.remove(); })();
      addEventListener('resize',()=>{ w=cv.width=innerWidth; h=cv.height=innerHeight; }, { once:true });
    }

    /* === Open feedback quickly if hash === */
    if(location.hash==="#contacto"){ fbModal.classList.add('show'); }
  </script>
</body>
</html>
