<!doctype html>
<html lang="es">
<head>
  <!-- Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DYZ3GCXHEK"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments)}; gtag('js', new Date()); gtag('config','G-DYZ3GCXHEK');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ITHub Â· Arena 4Ã—2 â€” Gana, la carta â€œexplotaâ€ y aparece otra</title>
  <meta name="description" content="Arena 4Ã—2: cada casilla es una misiÃ³n. Si aciertas, la carta celebra, se va y entra otra al instante. Sube de nivel y acumula monedas.">
  <meta name="robots" content="index, follow">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;utf8,
  <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>
    <defs><radialGradient id='g' cx='32' cy='32' r='32'><stop offset='0' stop-color='%2300f0ff'/><stop offset='1' stop-color='%23121428'/></radialGradient></defs>
    <rect width='64' height='64' rx='12' fill='url(%23g)'/>
    <text x='50%' y='58%' text-anchor='middle' font-size='28' font-family='monospace' font-weight='700' fill='%23fff'>IT</text>
  </svg>">

  <style>
    :root{
      --bg:#0b0f1c; --bg-2:#0a0e1b; --ink:#eef1ff; --muted:#9cb3ff;
      --ring:#26306a; --card:#0e1431; --card2:#0e1538;
      --accent:#00f0ff; --accent2:#7a5bff; --accent3:#ff6bd6;
      --good:#39e58c; --warn:#ffed66; --bad:#ff6270;
      --radius:14px; --shadow:0 20px 48px rgba(0,8,40,.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font:16px/1.55 Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      overflow-x:hidden;
      background:
        radial-gradient(1000px 600px at 10% -10%, rgba(0,240,255,.12), transparent 60%),
        radial-gradient(900px 520px at 110% 10%, rgba(122,91,255,.12), transparent 70%),
        radial-gradient(1200px 680px at 30% 110%, rgba(255,107,214,.10), transparent 70%),
        linear-gradient(180deg, var(--bg-2), var(--bg));
    }
    a{color:inherit; text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:0 18px}

    /* ===== CABECERA HORIZONTAL (sin navegaciÃ³n) ===== */
    header{
      position:static;
      background:linear-gradient(180deg, rgba(9,12,28,.85), rgba(9,12,28,.55));
      border-bottom:1px solid var(--ring);
    }
    .bar{display:flex; gap:14px; align-items:center; justify-content:space-between; height:76px;}
    .brand{display:flex; gap:10px; align-items:center; font-weight:1000; letter-spacing:.3px}
    .brand img{height:38px}
    .hud{display:flex; gap:10px; align-items:center}
    .chip{display:inline-flex; align-items:center; gap:6px; font-weight:900; padding:8px 12px; border-radius:999px; background:#0f1846; border:1px solid #2e3b7a}
    .btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; height:42px; padding:0 14px; border-radius:12px;
      border:1px solid var(--ring); background:linear-gradient(180deg,#15205b,#0e1642); color:#fff; font-weight:900; text-transform:uppercase}
    .btn:hover{border-color:#5a73ff; transform:translateY(-1px)}
    .btn-ghost{background:transparent;border-color:#3a49a6;color:#cfe2ff}
    .btn-danger{background:linear-gradient(180deg,#ff6474,#ff5270); border-color:#ff93a2}

    /* ===== HERO ===== */
    .hero{padding:26px 0 10px; text-align:center}
    .hero h1{
      margin:0; font-size:clamp(1.8rem, 4.2vw, 3rem); line-height:1.15; font-weight:1000;
      background:linear-gradient(90deg,#a7e0ff,#e5d3ff,#ffc9f0);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow:0 0 24px rgba(122,91,255,.25);
    }
    .lead{color:var(--muted); max-width:940px; margin:8px auto 0}
    .hero-actions{display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:12px}
    .cta{background:linear-gradient(180deg,#00f0ff,#6bbcff); color:#00111a; border:1px solid #8be9ff; box-shadow:0 12px 28px rgba(0,240,255,.2)}

    /* ===== LAYOUT PRINCIPAL ===== */
    main section{padding:22px 0}
    .grid{display:grid; gap:14px}
    @media(min-width:980px){ .cols-2{grid-template-columns:1.4fr 1fr} }

    .card{
      background:linear-gradient(180deg, var(--card2), var(--card));
      border:1px solid var(--ring); border-radius:var(--radius); box-shadow:var(--shadow); position:relative;
      padding:16px;
    }
    .head{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px}
    .tag{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; font-weight:900; border:1px solid #334089; color:#cfe2ff; background:linear-gradient(180deg,#101943,#0f1738)}
    .hint{color:#b9c9ff}

    /* ===== ARENA 4Ã—2 ===== */
    .arena-wrap{display:grid; grid-template-columns:repeat(4,1fr); gap:10px}
    @media(max-width:820px){ .arena-wrap{grid-template-columns:repeat(2,1fr);} }
    .tile{
      position:relative; min-height:120px; border-radius:12px; overflow:hidden;
      background:radial-gradient(180px 120px at 40% -10%, rgba(0,240,255,.18), transparent 60%), #0f153a;
      border:1px solid #2a387a; padding:10px; display:flex; flex-direction:column; gap:8px;
      transition: transform .12s ease, border-color .12s ease;
    }
    .tile:hover{transform:translateY(-2px); border-color:#4b63ff}
    .badge{display:inline-flex; align-items:center; gap:6px; padding:5px 8px; border-radius:999px; font-weight:900; background:#0e1847; border:1px solid #334089; font-size:12px}
    .tile h4{margin:2px 0 0; font-size:.98rem}
    .tile .row{display:flex; gap:8px; flex-wrap:wrap}
    .tile .play{margin-top:auto}

    /* ===== ANIMACIONES (ganar â†’ sale, entra nueva) ===== */
    @keyframes winOut {
      0%   { transform:scale(1); opacity:1; filter:blur(0) }
      60%  { transform:scale(1.05) rotate(-1deg); }
      100% { transform:scale(.82) rotate(-6deg); opacity:0; filter:blur(2px) }
    }
    @keyframes winIn {
      0%   { transform:scale(1.06) translateY(10px); opacity:0 }
      100% { transform:scale(1) translateY(0); opacity:1 }
    }
    .tile.win   { pointer-events:none; animation:winOut .46s ease forwards }
    .tile.enter { animation:winIn  .42s ease both }

    /* ===== PROGRESO & UX ===== */
    .meter{height:10px; border-radius:999px; background:#09102a; border:1px solid var(--ring); overflow:hidden}
    .meter>span{display:block; height:100%; width:0; background:linear-gradient(90deg,#39e58c,#7affb8)}

    /* ===== FOOTER ===== */
    footer{border-top:1px solid var(--ring); padding:24px 0; color:#b9c9ff}
    .fcols{display:grid; gap:14px}
    @media(min-width:860px){ .fcols{grid-template-columns:1.2fr .8fr .8fr .8fr} }
    footer a:hover{text-decoration:underline}

    /* A11y */
    .skip{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;}
    .skip:focus{position:fixed;left:12px;top:12px;background:#fff;color:#111;padding:10px 14px;border-radius:10px;z-index:9999;}
  </style>
</head>
<body>
  <a class="skip" href="#main">Saltar al contenido principal</a>

  <!-- CABECERA (sin menÃº de navegaciÃ³n) -->
  <header role="banner">
    <div class="container bar">
      <div class="brand">
        <img src="/assets/ithub-logo.svg" alt="ITHub">
        <div style="font-weight:1000">Arena 4Ã—2</div>
      </div>

      <div class="hud">
        <span class="chip">Lv. <b id="lvl">1</b></span>
        <span class="chip">ğŸ’ <b id="coins">0</b></span>
        <span class="chip">ğŸ”¥ <b id="streak">0</b>d</span>
        <a id="btnLogin" class="btn-ghost btn" href="/login/login.html">Login</a>
        <a id="btnSignup" class="btn btn" href="/login/login.html#signup">Crear cuenta</a>
        <div id="userArea" style="display:none;gap:8px;align-items:center">
          <span class="chip">ğŸ‘‹ <b id="nick">USER</b></span>
          <a class="btn-ghost btn" href="/user/profile.html">Perfil</a>
          <button id="btnLogout" class="btn-danger btn" type="button">Salir</button>
        </div>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="container">
      <h1>Juega en la Arena 4Ã—2: acierta, la carta celebra, desaparece y entra otra.</h1>
      <p class="lead">8 casillas activas. Cada victoria reemplaza esa casilla con una <b>nueva misiÃ³n</b> en vivo. Gana <b>XP</b>, <b>monedas</b> y mantÃ©n tu <b>racha</b>.</p>
      <div class="hero-actions">
        <a class="btn cta" href="#arena">Entrar a la Arena</a>
        <a class="btn" href="/score/ranking.html">Ver Ranking</a>
        <button id="dailySpinBtn" class="btn-ghost btn" type="button">ğŸ° Giro diario</button>
      </div>
    </div>
  </section>

  <main id="main">
    <section class="container grid cols-2">
      <!-- ARENA 4Ã—2 -->
      <article class="card" id="arena" aria-labelledby="arena-title">
        <div class="head">
          <div class="tag" id="arena-title">âš”ï¸ Arena â€” Tablero 4Ã—2</div>
          <div class="hint">Acierta â†’ animaciÃ³n de victoria â†’ entra misiÃ³n nueva</div>
        </div>
        <div id="board" class="arena-wrap" role="list"></div>
      </article>

      <!-- OBJETIVO + BOSSES (se mantiene) -->
      <article class="card">
        <div class="head">
          <div class="tag">ğŸ¯ Objetivo semanal</div>
          <div class="hint">70 preguntas</div>
        </div>
        <div class="meter" style="margin-top:4px"><span id="wbar"></span></div>
        <div style="display:flex;gap:10px;align-items:center;margin-top:8px">
          <span class="chip">ğŸ“ˆ <b id="wVal">0</b>/70</span>
          <button id="add5" class="btn-ghost btn" type="button">+5</button>
          <button id="resetW" class="btn-danger btn" type="button">Reset</button>
        </div>
        <hr style="border:0;border-top:1px solid var(--ring);margin:12px 0">
        <div class="head">
          <div class="tag">ğŸ‘‘ Jefes (simuladores)</div>
          <a class="btn-ghost btn" href="/score/ranking.html">Ranking â†’</a>
        </div>
        <div class="grid" style="grid-template-columns:1fr;gap:10px" id="bossList"></div>
      </article>
    </section>
  </main>

  <!-- FOOTER -->
  <footer role="contentinfo">
    <div class="container fcols">
      <div>
        <div style="font-weight:1000">ITHUB.ES</div>
        <p>Convierte el estudio en juego. Practica, compite y aprueba.</p>
        <div style="margin-top:8px;color:#9cb3ff">Â© <span id="y"></span> ITHub.es</div>
      </div>
      <div>
        <div class="tag">Simuladores</div>
        <p><a href="/certification/microsoft-azure/az-104/lz-azure-az-104.html">Azure AZ-104</a></p>
        <p><a href="/certification/microsoft-azure/az-305/lz-azure-az-305.html">Azure AZ-305</a></p>
        <p><a href="/certification/amazon aws/aws-saa-c03/lz-aws-saa-c03.html">AWS SAA-C03</a></p>
      </div>
      <div>
        <div class="tag">Colaboradores</div>
        <p><a href="https://mundoazure.cloud" rel="noopener" target="_blank">mundoazure.cloud</a></p>
      </div>
      <div>
        <div class="tag">Contacto</div>
        <p><a href="mailto:hello@ithub.es">hello@ithub.es</a></p>
      </div>
    </div>
  </footer>

  <!-- MODAL: PREGUNTA -->
  <div class="modal" id="qModal" role="dialog" aria-modal="true" aria-labelledby="qTitle">
    <div class="modal-card">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
        <div class="tag" id="qExam">AZ-104</div>
        <button id="qClose" class="btn-ghost btn" type="button">Cerrar</button>
      </div>
      <div class="q" style="background:linear-gradient(180deg,#0f193f,#0b1437);border:1px solid #2a387a;border-radius:12px;padding:12px;margin:8px 0">
        <div id="qDomain" class="hint">Dominio</div>
        <h3 id="qTitle" style="margin:8px 0 4px">...</h3>
        <div id="qOptions"></div>
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="qNext" class="btn" type="button" style="display:none">Continuar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: GIRO DIARIO -->
  <div class="modal" id="spinModal" role="dialog" aria-modal="true" aria-labelledby="spinTitle">
    <div class="modal-card" style="max-width:520px">
      <h3 id="spinTitle">ğŸ° Ruleta diaria</h3>
      <p class="hint">Una vez al dÃ­a. Gana monedas y XP extra.</p>
      <div id="spinWheel" class="card" style="height:180px; display:grid; place-items:center; font-size:34px; font-weight:1000; letter-spacing:1px">Listo</div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
        <button id="spinGo" class="btn">Girar</button>
        <button id="spinClose" class="btn-ghost btn">Cerrar</button>
      </div>
    </div>
  </div>

  <script>
    /* ===== Util ===== */
    const $ = s => document.querySelector(s);
    $('#y').textContent = new Date().getFullYear();

    /* ===== Estado jugador ===== */
    const state = {
      coins: Number(localStorage.getItem('game_coins')||'0'),
      xp: Number(localStorage.getItem('game_xp')||'0'),
      level: Number(localStorage.getItem('game_level')||'1'),
      weekly: Number(localStorage.getItem('game_weekly')||'0'),
      lastSpin: localStorage.getItem('game_lastSpin')||'',
    };
    function save(){ localStorage.setItem('game_coins',state.coins); localStorage.setItem('game_xp',state.xp); localStorage.setItem('game_level',state.level); localStorage.setItem('game_weekly',state.weekly); }
    function addXP(n){ state.xp+=n; while(state.xp >= state.level*20){ state.xp-=state.level*20; state.level++; toast('ğŸ‰ Â¡Nivel '+state.level+'!'); } save(); hud(); }
    function addCoins(n){ state.coins+=n; save(); hud(); }
    function hud(){ $('#coins').textContent = state.coins; $('#lvl').textContent = state.level; }
    hud();

    /* ===== Auth HUD ===== */
    function getUser(){ try{ return JSON.parse(localStorage.getItem('currentUser')||'null'); }catch{ return null; } }
    function renderAuth(){
      const u=getUser();
      if(u){ $('#btnLogin').style.display='none'; $('#btnSignup').style.display='none'; $('#userArea').style.display='flex'; $('#nick').textContent=(u.name||u.email||'USER').toUpperCase(); }
      else{ $('#btnLogin').style.display='inline-flex'; $('#btnSignup').style.display='inline-flex'; $('#userArea').style.display='none'; }
    }
    $('#btnLogout')?.addEventListener('click',()=>{ localStorage.removeItem('currentUser'); renderAuth(); });
    renderAuth();

    /* ===== Racha diaria ===== */
    (function streak(){
      const KS='game_streak';
      const d=new Date(); d.setHours(0,0,0,0); const today=d.getTime();
      let s=JSON.parse(localStorage.getItem(KS)||'{"days":0,"last":0}');
      if(s.last!==today){ s.days=(s.last===today-86400000)? s.days+1 : 1; s.last=today; localStorage.setItem(KS, JSON.stringify(s)); }
      $('#streak').textContent = s.days+'d';
    })();

    /* ===== Objetivo semanal ===== */
    function weeklyRender(){
      const pct=Math.min(100, Math.round(state.weekly/70*100));
      $('#wVal').textContent=state.weekly; $('#wbar').style.width=pct+'%';
    }
    $('#add5').addEventListener('click', ()=>{ state.weekly=Math.min(70,state.weekly+5); save(); weeklyRender(); if(state.weekly===70) confetti(); });
    $('#resetW').addEventListener('click', ()=>{ state.weekly=0; save(); weeklyRender(); });
    weeklyRender();

    /* ===== Bosses (Simuladores) ===== */
    const BOSSES = [
      { id:'AZ-104', title:'Azure Administrator', url:'/certification/microsoft-azure/az-104/lz-azure-az-104.html', tag:'AZURE' },
      { id:'AZ-305', title:'Azure Architect',     url:'/certification/microsoft-azure/az-305/lz-azure-az-305.html', tag:'AZURE' },
      { id:'SAA-C03', title:'AWS Architect',      url:'/certification/amazon aws/aws-saa-c03/lz-aws-saa-c03.html', tag:'AWS' }
    ];
    (function renderBosses(){
      const box=$('#bossList'); box.innerHTML='';
      BOSSES.forEach(b=>{
        const el=document.createElement('a'); el.href=b.url; el.className='card'; el.style.padding='12px';
        el.innerHTML=`<div class="tag">${b.tag} Â· ${b.id}</div><h4 style="margin:6px 0">${b.title}</h4><div class="hint">Modo examen cronometrado</div>`;
        box.appendChild(el);
      });
    })();

    /* ===== Banco de preguntas ===== */
    const BANK = [
      // AZ-104
      { exam:"AZ-104", domain:"Identidades", q:"Â¿QuÃ© servicio centraliza reglas de acceso a nivel suscripciÃ³n/grupo de recursos?", options:["Azure Policy","Azure Blueprints","RBAC (roles)","PIM"], answerIndex:2 },
      { exam:"AZ-104", domain:"Almacenamiento", q:"Â¿QuÃ© opciÃ³n asegura WORM legalmente inmutable?", options:["Soft delete","Versioning","Immutable Blob (Time-based)","GRS"], answerIndex:2 },
      { exam:"AZ-104", domain:"Red", q:"Web multizona + TLS + WAF gestionado:", options:["Traffic Manager","Application Gateway","Front Door","Load Balancer"], answerIndex:2 },
      { exam:"AZ-104", domain:"Conectividad", q:"ConexiÃ³n on-prem con SLA y BGP:", options:["S2S VPN","P2S VPN","ExpressRoute","VNet Peering"], answerIndex:2 },
      // AZ-305
      { exam:"AZ-305", domain:"Red", q:"Global L7 + WAF + TLS + enrutamiento cercano:", options:["Traffic Manager","Azure Front Door (Std/Prem)","Application Gateway","Load Balancer"], answerIndex:1 },
      { exam:"AZ-305", domain:"Datos", q:"DB global, latencia ms y multi-master:", options:["SQL MI","Cosmos DB","PostgreSQL Flex","SQL VM"], answerIndex:1 },
      { exam:"AZ-305", domain:"Continuidad", q:"DR entre regiones con RPO minutos:", options:["Backup RSV","Traffic Manager","Availability Sets","Azure Site Recovery"], answerIndex:3 },
      { exam:"AZ-305", domain:"Data Lake", q:"Espacios tipo carpeta + ACL POSIX:", options:["Azure Files","ADLS Gen2","Managed Disks","Queue"], answerIndex:1 },
      // SAA-C03
      { exam:"SAA-C03", domain:"Seguro", q:"Acceso a S3 sin Internet desde VPC:", options:["Gateway Endpoint","Interface Endpoint","NAT Gateway","IGW"], answerIndex:0 },
      { exam:"SAA-C03", domain:"Rendimiento", q:"Bajo ms, millones RPS, esquema flexible:", options:["RDS MySQL","DynamoDB","Aurora PostgreSQL","Neptune"], answerIndex:1 },
      { exam:"SAA-C03", domain:"HA", q:"Publicar eventos a muchos consumidores:", options:["FIFO queue","SNS fanout","S3 event","Kinesis Firehose"], answerIndex:1 },
      { exam:"SAA-C03", domain:"Coste", q:"Batch oportunista en EC2:", options:["On-Demand","Savings Plans","Spot","Dedicated Host"], answerIndex:2 },
    ];
    let missionCounter = 0;
    function makeMissionFromQ(q){
      missionCounter++;
      const xp = 8 + Math.floor(Math.random()*7);        // 8â€“14 XP
      const coins = 2 + Math.floor(Math.random()*3);     // 2â€“4 monedas
      return { id: 'm_'+missionCounter, label:`${q.exam} Â· ${q.domain}`, exam:q.exam, qref:q, reward:{xp,coins} };
    }
    const MISSIONS_POOL = BANK.flatMap(q => Array.from({length:3}, ()=>makeMissionFromQ(q))); // 3 variantes por pregunta

    /* ===== Tablero 4Ã—2 con animaciones ===== */
    const BOARD_SIZE = 8;
    const board = [];
    const visibleIds = new Set();

    function drawMission(){
      for(let tries=0; tries<200; tries++){
        const m = MISSIONS_POOL[Math.floor(Math.random()*MISSIONS_POOL.length)];
        if(!visibleIds.has(m.id)) return m;
      }
      return MISSIONS_POOL[Math.floor(Math.random()*MISSIONS_POOL.length)];
    }

    function bootBoard(){
      board.length = 0; visibleIds.clear();
      for(let i=0;i<BOARD_SIZE;i++){
        let m = drawMission(); let s=0; while(visibleIds.has(m.id) && s++<50){ m = drawMission(); }
        board.push(m); visibleIds.add(m.id);
      }
      renderBoard();
    }

    function tileHTML(m, index){
      return `
        <div class="row">
          <span class="badge">ğŸ¯ ${m.exam}</span>
          <span class="badge">+${m.reward.xp} XP</span>
          <span class="badge">+${m.reward.coins} ğŸ’</span>
        </div>
        <h4>${m.label}</h4>
        <div class="hint">Reto relÃ¡mpago: 1 pregunta</div>
        <div class="row play">
          <button class="btn" data-play="${index}">Jugar</button>
        </div>
      `;
    }

    function renderBoard(){
      const grid = $('#board'); grid.innerHTML='';
      board.forEach((m, idx)=>{
        const tile = document.createElement('div'); tile.className='tile enter'; tile.setAttribute('role','listitem');
        tile.innerHTML = tileHTML(m, idx);
        grid.appendChild(tile);
      });
    }

    // Reemplazo con animaciÃ³n: winOut del antiguo, winIn del nuevo
    function replaceMissionAt(index){
      const grid = $('#board');
      const oldTile = grid.children[index];
      const old = board[index];
      if(!oldTile || !old) return;

      oldTile.classList.add('win');
      oldTile.addEventListener('animationend', ()=>{
        // Borrar del set visible y crear nueva misiÃ³n
        visibleIds.delete(old.id);
        let next = drawMission(); let guard=0; while(visibleIds.has(next.id) && guard++<50){ next = drawMission(); }
        board[index] = next; visibleIds.add(next.id);

        // Reemplazo del DOM
        oldTile.className = 'tile enter';
        oldTile.innerHTML = tileHTML(next, index);
      }, { once:true });
    }

    // Clicks del tablero
    $('#board').addEventListener('click', e=>{
      const btn = e.target.closest('button[data-play]'); if(!btn) return;
      const i = Number(btn.dataset.play);
      const m = board[i]; if(!m) return;
      openQuestion(m.qref, (correct)=>{
        if(correct){
          addXP(m.reward.xp); addCoins(m.reward.coins);
          state.weekly = Math.min(70, state.weekly+1); save(); weeklyRender();
          toast(`âœ… +${m.reward.xp} XP Â· +${m.reward.coins} ğŸ’`);
          replaceMissionAt(i);   // â† animaciÃ³n de victoria + entrada de nueva
          confetti();
        }
      });
    });

    /* ===== Modal de pregunta ===== */
    const qModal = $('#qModal'), qTitle=$('#qTitle'), qOptions=$('#qOptions'), qDomain=$('#qDomain'), qExam=$('#qExam'), qNext=$('#qNext');
    let onDone = null;
    function openQuestion(q, cb){
      onDone = cb;
      qTitle.textContent = q.q;
      qDomain.textContent = 'Dominio: '+q.domain;
      qExam.textContent = q.exam;
      qOptions.innerHTML='';
      q.options.forEach((t,i)=>{
        const el=document.createElement('label'); el.className='opt';
        el.innerHTML=`<input type="radio" name="qp" value="${i}"><span>${t}</span>`;
        qOptions.appendChild(el);
      });
      qOptions.addEventListener('change', e=>{
        const v=Number(e.target.value);
        [...qOptions.querySelectorAll('.opt')].forEach((l,ii)=>{ l.classList.remove('correct','wrong'); if(ii===q.answerIndex) l.classList.add('correct'); if(ii===v && ii!==q.answerIndex) l.classList.add('wrong'); });
        qNext.style.display='inline-flex';
        qNext.onclick=()=>{ qModal.classList.remove('show'); if(onDone) onDone(v===q.answerIndex); };
      }, { once:true });
      qNext.style.display='none';
      qModal.classList.add('show');
    }
    $('#qClose').addEventListener('click', ()=> qModal.classList.remove('show'));
    qModal.addEventListener('click', e=>{ if(e.target===qModal) qModal.classList.remove('show'); });

    /* ===== Ruleta diaria ===== */
    const spinModal=$('#spinModal'); const spinBtn=$('#dailySpinBtn'); const spinGo=$('#spinGo'); const spinWheel=$('#spinWheel');
    spinBtn.addEventListener('click', ()=>{ spinModal.classList.add('show'); spinWheel.textContent='Listo'; });
    $('#spinClose').addEventListener('click', ()=> spinModal.classList.remove('show'));
    spinModal.addEventListener('click', e=>{ if(e.target===spinModal) spinModal.classList.remove('show'); });
    spinGo.addEventListener('click', ()=>{
      const today = new Date().toISOString().slice(0,10);
      if(state.lastSpin===today){ spinWheel.textContent='â³ MaÃ±ana de nuevo'; return; }
      const prizes = [
        { t:'+3 ğŸ’',  c:()=>addCoins(3) }, { t:'+6 ğŸ’',  c:()=>addCoins(6) },
        { t:'+5 XP',  c:()=>addXP(5) },   { t:'+10 XP', c:()=>addXP(10) },
        { t:'+2 ğŸ’ +5 XP', c:()=>{ addCoins(2); addXP(5); } },
      ];
      spinWheel.textContent='Girandoâ€¦';
      let i=0; const spin=setInterval(()=>{ spinWheel.textContent=prizes[i%prizes.length].t; i++; }, 80);
      setTimeout(()=>{ clearInterval(spin); const p=prizes[Math.floor(Math.random()*prizes.length)]; p.c(); spinWheel.textContent='ğŸ‰ '+p.t; state.lastSpin=today; localStorage.setItem('game_lastSpin', state.lastSpin); confetti(); }, 1400);
    });

    /* ===== Micro-UX ===== */
    function toast(text){
      const n=document.createElement('div');
      n.textContent=text;
      n.style.cssText='position:fixed;left:50%;top:16px;transform:translateX(-50%);background:linear-gradient(180deg,#18256b,#111a4f);border:1px solid #3a49a6;padding:10px 14px;border-radius:10px;font-weight:900;box-shadow:var(--shadow);z-index:999;color:#e7eeff';
      document.body.appendChild(n);
      setTimeout(()=>{ n.style.transition='all .5s ease'; n.style.opacity='0'; n.style.transform='translateX(-50%) translateY(-16px)'; }, 1200);
      setTimeout(()=> n.remove(), 1900);
    }
    function confetti(){
      const cv=document.createElement('canvas'); cv.style.cssText='position:fixed;inset:0;pointer-events:none;z-index:110;'; document.body.appendChild(cv);
      const ctx=cv.getContext('2d'); let w=cv.width=innerWidth, h=cv.height=innerHeight;
      const P=Array.from({length:110},()=>({x:Math.random()*w,y:-20-Math.random()*h,vx:(Math.random()-.5)*3,vy:2+Math.random()*4,s:6+Math.random()*6,c:Math.random()*360}));
      let t=0; (function loop(){ ctx.clearRect(0,0,w,h); t+=.02; for(const p of P){ p.vy+=.02; p.x+=p.vx; p.y+=p.vy; ctx.fillStyle=`hsl(${(p.c+t*180)%360} 90% 60%)`; ctx.fillRect(p.x,p.y,p.s,p.s); } if(t<3.2) requestAnimationFrame(loop); else cv.remove(); })();
      addEventListener('resize',()=>{ w=cv.width=innerWidth; h=cv.height=innerHeight; }, { once:true });
    }

    /* ===== Inicializar tablero ===== */
    bootBoard();
  </script>
</body>
</html>
