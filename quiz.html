<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Quiz ‚Ä¢ CertifyLab</title>

  <!-- Tema oscuro local, sin style_global.css -->
  <style>
    :root{
      --bg:#0f1320;--surface:#161b2d;--surface2:#1b2140;--ink:#e8ecff;--muted:#9ca8d9;--stroke:#283056;
      --aws:#ff9900;--azure:#0078d4;--radius:14px;--shadow:0 10px 24px rgba(6,12,40,.45);
      --accent:#6c8bff;--accent-2:#3e64ff;--accent-ring:rgba(108,139,255,.28);
      --ok:#25b873;--bad:#ff6b6b;--warn:#ffd063;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;line-height:1.6}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}

    /* Header compacto */
    header{position:sticky;top:0;z-index:50;backdrop-filter:blur(10px);
      background:linear-gradient(180deg,rgba(15,19,32,.85),rgba(15,19,32,.55));
      border-bottom:1px solid var(--stroke)}
    .nav{height:64px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900}
    .dot{width:10px;height:10px;border-radius:50%;background:#6c8bff;box-shadow:0 0 0 6px rgba(108,139,255,.18)}
    .menu{display:none;gap:18px;color:var(--muted);font-weight:700}
    .menu a:hover{color:var(--ink)}
    .actions{display:none;gap:10px;align-items:center}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;
      padding:10px 14px;border-radius:12px;border:1px solid var(--stroke);cursor:pointer;font-weight:800}
    .btn.primary{background:linear-gradient(180deg,#6c8bff,#3e64ff);border:none;color:#fff;box-shadow:var(--shadow)}
    .btn.ghost{background:transparent}
    .userchip{display:flex;align-items:center;gap:8px;background:var(--surface2);border:1px solid var(--stroke);padding:8px 12px;border-radius:999px}
    .userchip b{white-space:nowrap}
    @media(min-width:720px){.menu,.actions{display:flex}}

    /* Paneles principales */
    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;margin-top:16px}
    @media(max-width:860px){.grid{grid-template-columns:1fr}}
    .panel{background:var(--surface);border:1px solid var(--stroke);border-radius:12px;padding:16px;box-shadow:var(--shadow)}
    .panel h2,.panel h3{margin:0 0 10px}

    /* Badge del examen */
    .badge-pill{
      display:inline-flex;align-items:center;gap:10px;border:1px solid #ffffff1f;background:#ffffff10;
      padding:8px 12px;border-radius:999px;font-weight:900
    }

    /* Lista de dominios (clickable) ‚Äî tama√±o como ‚Äúantes‚Äù */
    .domains-list{list-style:none;padding-left:0;margin:0;display:grid;gap:12px}
    .dom-item{
      display:flex;align-items:center;gap:12px;
      border:1px solid var(--stroke);background:var(--surface2);
      border-radius:14px;padding:14px 16px;cursor:pointer;transition:transform .08s,border .12s,box-shadow .12s
    }
    .dom-item:hover{transform:translateY(-1px);border-color:#3a4883;box-shadow:0 10px 24px rgba(0,0,0,.25)}
    .dom-dot{width:14px;height:14px;border-radius:50%;border:2px solid currentColor}
    .dom-code{font-weight:900;min-width:42px;text-align:center;color:#cbd6ff}
    .dom-title{font-weight:800}
    .dom-item.active{outline:3px solid var(--accent-ring)}

    /* INFO_DOM */
    .infoDom{margin-top:16px}
    .info-head{display:flex;align-items:center;justify-content:space-between;margin:0 0 8px}
    .info-box{
      background:linear-gradient(180deg,#111937,#0f1633);
      border:1px solid var(--stroke);border-radius:14px;padding:16px;box-shadow:var(--shadow);color:var(--ink)
    }
    .info-content{line-height:1.65}
    .info-content h1,.info-content h2,.info-content h3{color:#eaf0ff}
    .info-content p,.info-content li{color:#dbe4ff}
    .info-empty{color:var(--muted);border:1px dashed var(--stroke);padding:12px;border-radius:10px;background:#0f1630}

    /* Tarjeta simulador (derecha) */
    .segmented{display:flex;gap:8px;background:var(--surface2);border:1px solid var(--stroke);border-radius:10px;padding:6px}
    .segmented input{display:none}
    .segmented label{flex:1;text-align:center;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:800}
    .segmented input:checked + label{background:#0f1630;border:1px solid #31407a}
    .field{display:flex;flex-direction:column;gap:6px;margin-top:10px}
    .select{display:flex;gap:8px}
    .select select{border:1px solid var(--stroke);border-radius:10px;padding:8px 10px;background:var(--surface2);color:var(--ink)}

    /* FOOTER */
    footer{margin:32px 0 12px;color:#8fa4ff99;text-align:center;font-size:.95rem}
    footer a{color:#bcd3ff}
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="wrap nav">
      <div class="brand"><span class="dot"></span> CertifyLab</div>
      <nav class="menu">
        <a href="/index.html">Home</a>
        <a href="/index.html#simuladores">Simuladores</a>
        <a href="/index.html#contenidos">Contenidos</a>
        <a href="/score/ranking.html">Ranking</a>
      </nav>
      <div class="actions" id="authActions">
        <a class="btn" id="btnLogin" href="/login/login.html">Login</a>
        <a class="btn primary" id="btnSignup" href="/login/login.html#signup">Crear cuenta</a>
        <div class="userchip" id="userChip" style="display:none">
          <span>üëã</span><b id="userNameTop">Usuario</b>
          <a class="btn" href="/user/profile.html">Perfil</a>
          <button class="btn" id="btnLogout" type="button">Salir</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Contenido principal -->
  <div class="wrap" id="root">
    <!-- Encabezado + atajos -->
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div id="badge" class="badge-pill"></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <a id="rankLinkTop" class="btn" href="#">üèÜ Ranking</a>
        <a class="btn" href="/index.html">üè† Home</a>
      </div>
    </div>

    <!-- Informaci√≥n + simulador -->
    <div class="grid">
      <!-- Columna izquierda: descripci√≥n + dominios -->
      <section class="panel" id="leftInfo">
        <div style="display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap">
          <img id="provLogo" alt="" style="width:66px;height:auto">
          <div id="provText" style="color:var(--muted)">Loading‚Ä¶</div>
        </div>

        <h2 style="margin-top:14px">Exam Domains</h2>
        <p style="margin-top:-6px;color:var(--muted)"><em>üòé‚úèÔ∏è Click a domain to open helpful notes below.</em></p>

        <ul id="domainsList" class="domains-list"></ul>

        <!-- INFO_DOM -->
        <section id="infoDom" class="infoDom" hidden>
          <div class="info-head">
            <h3 id="infoTitle" style="margin:0">Domain notes</h3>
            <button id="infoClose" class="btn">‚úñ Close</button>
          </div>
          <div class="info-box">
            <div id="infoContent" class="info-content">
              <div class="info-empty">Pick a domain above to load concise study notes right here.</div>
            </div>
          </div>
        </section>
      </section>

      <!-- Columna derecha: simulador -->
      <aside class="panel" id="simCard">
        <h3 id="simTitle">Exam Simulator</h3>

        <div class="field">
          <label>Mode</label>
          <div class="segmented">
            <input type="radio" id="modePractice" name="mode" value="practice" checked>
            <label for="modePractice">Practice</label>
            <input type="radio" id="modeExam" name="mode" value="exam">
            <label for="modeExam">Exam</label>
          </div>
        </div>

        <div class="field">
          <label>Questions</label>
          <div class="select">
            <select id="qCount">
              <option>5</option><option>10</option><option>15</option><option>30</option><option>65</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label>Domains (optional filter)</label>
          <div id="domainChips" style="display:flex;flex-wrap:wrap;gap:8px"></div>
          <div style="color:var(--muted)">Leave empty to include all domains.</div>
        </div>

        <div class="field" style="margin-top:12px">
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button id="startBtn" class="btn" style="background:var(--accent);color:#fff;border-color:transparent;box-shadow:var(--shadow)">‚ñ∂ Start Quiz</button>
            <a id="rankLink" class="btn" href="#">üèÜ Ranking</a>
          </div>
          <div style="color:var(--muted);margin-top:8px">
            Shortcuts: <span class="btn" style="padding:2px 6px">N</span> Next,
            <span class="btn" style="padding:2px 6px">B</span> Back,
            <span class="btn" style="padding:2px 6px">M</span> Mark,
            <span class="btn" style="padding:2px 6px">1-9</span> choose.
          </div>
        </div>
      </aside>
    </div>

    <!-- Aqu√≠ pinta Q_global_dark.js -->
    <main id="view"></main>
  </div>

  <footer>
    Made with ‚ù§Ô∏è by CertifyLab ‚Ä¢ <a href="/index.html#contenidos">Study notes</a> ¬∑ <a href="/score/ranking.html">Ranking</a>
  </footer>

  <!-- Motor de la quiz (tu JS oscuro) -->
  <script src="/control_quizs/Q_global_dark.js" defer></script>

  <script>
    /* ====== Auth header m√≠nimo ====== */
    function getCurrentUser(){ try{return JSON.parse(localStorage.getItem("currentUser")||"null");}catch{return null;} }
    function renderAuth(){
      const u = getCurrentUser();
      const chip = document.getElementById('userChip');
      const nameEl = document.getElementById('userNameTop');
      const btnLogin = document.getElementById('btnLogin');
      const btnSignup = document.getElementById('btnSignup');
      const btnLogout = document.getElementById('btnLogout');
      if(u){ nameEl.textContent = u.name || u.email || 'Usuario'; chip.style.display='flex'; btnLogin.style.display='none'; btnSignup.style.display='none'; }
      else { chip.style.display='none'; btnLogin.style.display=''; btnSignup.style.display=''; }
      btnLogout?.addEventListener('click', ()=>{ localStorage.removeItem('currentUser'); renderAuth(); });
    }
    renderAuth();

    /* ====== Config del examen ====== */
    const qs = k => new URLSearchParams(location.search).get(k);
    const QUIZ = (qs('quiz')||'').toLowerCase();         // az-104 | aws-saa-c03
    const IS_AZ = QUIZ.startsWith('az');
    const BRAND_CLR = IS_AZ ? getComputedStyle(document.documentElement).getPropertyValue('--azure')
                            : getComputedStyle(document.documentElement).getPropertyValue('--aws');

    const CONFIG = {
      'aws-saa-c03': {
        title: 'AWS SOLUTIONS ARCHITECT ‚Äî ASSOCIATE (SAA-C03)',
        logo: 'https://upload.wikimedia.org/wikipedia/commons/9/93/Amazon_Web_Services_Logo.svg',
        blurb: 'Design secure and cost-optimized AWS architectures. Perfect if you‚Äôve got some AWS or strong on-prem experience.',
        domains: [
          ['D1','Design Secure Architectures (30%)'],
          ['D2','Design Resilient Architectures (26%)'],
          ['D3','Design High-Performing Architectures (24%)'],
          ['D4','Design Cost-Optimized Architectures (20%)'],
        ],
      },
      'az-104': {
        title: 'MICROSOFT AZURE ADMINISTRATOR ‚Äî ASSOCIATE (AZ-104)',
        logo: 'https://upload.wikimedia.org/wikipedia/commons/a/a8/Microsoft_Azure_Logo.svg',
        blurb: 'Master Azure admin essentials: identities, governance, compute, networking and monitoring.',
        domains: [
          ['D1','Manage identities & governance (15‚Äì20%)'],
          ['D2','Implement & manage storage (15‚Äì20%)'],
          ['D3','Deploy & manage compute (20‚Äì25%)'],
          ['D4','Configure & manage networking (20‚Äì25%)'],
          ['D5','Monitor & maintain resources (10‚Äì15%)'],
        ],
      }
    };

    /* ====== Mapeo de archivos HTML por dominio (los que me pasaste) ====== */
    const DOMAIN_FILES = {
      'az-104': {
        D1: '/tips/azure-az104-tips-domain1.html',
        D2: '/tips/azure-az104-tips-domain2.html',
        D3: '/tips/azure-az104-tips-domain3.html',
        D4: '/tips/azure-az104-tips-domain4.html',
        D5: '/tips/azure-az104-tips-domain5.html',
      },
      'aws-saa-c03': {
        D1: '/tips/aws-saa-c03-tips-domain1.html',
        D2: '/tips/aws-saa-c03-tips-domain2.html',
        D3: '/tips/aws-saa-c03-tips-domain3.html',
        D4: '/tips/aws-saa-c03-tips-domain4.html',
      }
    };

    /* ====== Referencias DOM ====== */
    const badge=document.getElementById('badge'),
          provLogo=document.getElementById('provLogo'),
          provText=document.getElementById('provText'),
          dlist=document.getElementById('domainsList'),
          chips=document.getElementById('domainChips'),
          simTitle=document.getElementById('simTitle'),
          startBtn=document.getElementById('startBtn'),
          qCount=document.getElementById('qCount'),
          rankLink=document.getElementById('rankLink'),
          rankLinkTop=document.getElementById('rankLinkTop'),
          infoDom=document.getElementById('infoDom'),
          infoTitle=document.getElementById('infoTitle'),
          infoContent=document.getElementById('infoContent'),
          infoClose=document.getElementById('infoClose');

    const cfg = CONFIG[QUIZ];
    if(!cfg){
      document.getElementById('root').innerHTML = `<div class="panel">Quiz desconocido: <b>${QUIZ||'(vac√≠o)'}</b>. <a href="/index.html">Volver</a></div>`;
    } else {
      // Branding
      badge.style.borderColor = BRAND_CLR.trim() + '33';
      badge.style.background = BRAND_CLR.trim() + '1f';
      badge.innerHTML = `<span style="width:10px;height:10px;border-radius:50%;background:${BRAND_CLR}"></span> ${cfg.title}`;
      provLogo.src = cfg.logo; provLogo.alt = IS_AZ?'Azure':'AWS';
      provText.textContent = cfg.blurb;
      simTitle.textContent = (QUIZ.toUpperCase()) + ' Exam Simulator';

      // Lista de dominios (izquierda)
      dlist.innerHTML = cfg.domains.map(([d,txt]) =>
        `<li class="dom-item" data-dn="${d}">
           <span class="dom-dot" style="color:${BRAND_CLR}"></span>
           <span class="dom-code">${d}</span>
           <span class="dom-title">${txt}</span>
         </li>`).join('');

      // Chips de filtro (derecha)
      chips.innerHTML = cfg.domains.map(([d]) =>
        `<label class="btn" style="background:#0f1630;border-color:#313c6e"><input type="checkbox" value="${d}" style="display:none"> ${d}</label>`
      ).join('');

      // Ranking links
      rankLink.href = `/score/ranking.html?quiz=${encodeURIComponent(QUIZ)}`;
      rankLinkTop.href = rankLink.href;

      // Start quiz (usa tu motor global)
      startBtn.addEventListener('click', ()=>{
        const count = parseInt(qCount.value,10) || 65;
        const tags = Array.from(chips.querySelectorAll('input[type="checkbox"]:checked')).map(cb=>cb.value);
        if(typeof window.start === 'function'){
          window.start(QUIZ, { count, tags });
        }else{
          alert('Motor de quiz no cargado.');
        }
      });
    }

    /* ====== INFO_DOM: loader de HTML incrustado ====== */
    async function loadDomainNotes(domainCode){
      const map = DOMAIN_FILES[QUIZ]||{};
      const file = map[domainCode];
      // UI
      infoTitle.textContent = `${domainCode} ‚Äî Notes`;
      infoDom.hidden = false;
      infoContent.innerHTML = `<div class="info-empty">Loading notes‚Ä¶</div>`;

      if(!file){
        infoContent.innerHTML = `<div class="info-empty">No notes file mapped for <b>${domainCode}</b>.</div>`;
        return;
      }
      try{
        const res = await fetch(file, {cache:'no-store'});
        const html = await res.text();
        // Parse: tomamos solo el contenido √∫til del body
        const doc = new DOMParser().parseFromString(html, 'text/html');
        // quitamos scripts/links para evitar estilos claros
        doc.querySelectorAll('script,link').forEach(n=>n.remove());
        // preferimos .wrap si existe; si no, el body entero
        const src = doc.querySelector('.wrap') || doc.body;
        const cleaned = src ? src.innerHTML : html;

        // Inyectamos dentro de un contenedor con nuestros estilos oscuros
        infoContent.innerHTML = cleaned;

        // Ajustes r√°pidos de contraste para bloques claros que traiga el HTML
        infoContent.querySelectorAll('[style]').forEach(el=>{
          const s = el.getAttribute('style');
          if(/background:\s*#fff|#ffffff|rgb\(\s*255\s*,\s*255\s*,\s*255\s*\)/i.test(s)){
            el.style.background = '#10183a';
            el.style.borderColor = 'var(--stroke)';
            el.style.color = 'var(--ink)';
          }
        });
      }catch(e){
        console.warn('notes load error', e);
        infoContent.innerHTML = `<div class="info-empty">Couldn‚Äôt load notes for <b>${domainCode}</b>. (${e?.message||'error'})</div>`;
      }
    }

    // Click en dominios
    dlist.addEventListener('click', (ev)=>{
      const li = ev.target.closest('.dom-item');
      if(!li) return;
      dlist.querySelectorAll('.dom-item').forEach(x=>x.classList.remove('active'));
      li.classList.add('active');
      loadDomainNotes(li.dataset.dn);
      // scroll a la secci√≥n
      infoDom.scrollIntoView({behavior:'smooth',block:'start'});
    });

    // Cerrar INFO_DOM
    infoClose.addEventListener('click', ()=>{
      infoDom.hidden = true;
      dlist.querySelectorAll('.dom-item').forEach(x=>x.classList.remove('active'));
    });
  </script>
</body>
</html>
