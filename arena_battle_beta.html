<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Arena Battle ‚Äì Quizzes Rel√°mpago (AZ-104, AZ-305, SAA-C03)</title>
<meta name="description" content="Arena Battle 3√ó3. Elige certificaci√≥n, responde misiones, gana XP y sube de nivel. Ranking en tiempo real y recursos recomendados." />
<meta name="theme-color" content="#0b0f1e" />
<link rel="icon" type="image/svg+xml" 
href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><defs><linearGradient id='g' x1='0' y1='0' x2='0' y2='1'><stop stop-color='%238aa0ff'/><stop offset='1' stop-color='%23425dff'/></linearGradient></defs><rect rx='12' width='64' height='64' fill='url(%23g)'/><text x='32' y='42' font-family='Segoe UI,Arial' font-size='28' fill='white' font-weight='900' text-anchor='middle'>IT</text></svg>">

<style>
:root{
  --bg:#0b0f1e;--panel:#0f1530;--panel2:#121a3b;--line:#26305e;--ink:#e8edff;--muted:#9fb2ff;
  --ok:#38d97a;--bad:#ff7272;
  --chip:#0f1736;--chipLine:#324081;
  --az-soft:rgba(108,139,255,.15); /* azul suave */
  --aws-soft:rgba(255,153,0,.18);  /* naranja suave */
}

*{box-sizing:border-box}
html,body{
  margin:0;
  background:
    radial-gradient(1200px 600px at 80% -10%, rgba(126,107,255,.14),transparent 60%),
    radial-gradient(900px 500px at 0% -20%, rgba(124,212,255,.14),transparent 60%),
    var(--bg);
  color:var(--ink);
  font-family:Inter, ui-sans-serif, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}

/* Header */
header{background:#0e1328;border-bottom:1px solid var(--line);}
.nav{max-width:1200px;margin:0 auto;display:flex;gap:14px;align-items:center;justify-content:space-between;padding:12px 18px}
.brand{display:flex;align-items:center;gap:10px;font-weight:900}
.brand .logo{width:30px;height:30px;border-radius:10px;background:linear-gradient(180deg,#8aa0ff,#425dff);box-shadow:0 0 0 8px rgba(130,150,255,.14)}
.nav-right{display:flex;gap:10px;align-items:center;}
.badge{padding:8px 12px;border-radius:999px;border:1px solid #2b356a;background:#10183a;font-weight:900;display:inline-flex;align-items:center;gap:8px;}
.user{padding:8px 12px;border-radius:12px;border:1px solid #2b356a;background:#10183a;font-weight:900}

/* Contenedor */
.container{max-width:1200px;margin:0 auto;padding:18px}

/* T√≠tulo */
h1{margin:8px 0 6px;font-size:clamp(1.6rem,3.2vw,2.4rem);line-height:1.2}
.lead{color:var(--muted);margin:0 0 14px}

/* Layout principal */
.layout{display:grid;grid-template-columns:1fr 360px;gap:16px}
@media(max-width:980px){.layout{grid-template-columns:1fr}}

/* Paneles */
.panel{background:linear-gradient(180deg,var(--panel),#0e1533);border:1px solid var(--line);border-radius:16px;overflow:hidden}
.panel-head{display:flex;flex-direction:column;gap:10px;padding:12px;border-bottom:1px solid var(--line);background:var(--panel2)}
.head-row{display:flex;gap:12px;align-items:center;justify-content:center;flex-wrap:wrap}

/* Filtros */
.hint{display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border-radius:999px;border:1px solid var(--chipLine);background:var(--chip);font-weight:900}
.filters{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.filter{display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border:1px solid var(--chipLine);background:linear-gradient(180deg,#0f1736,#121d48);border-radius:999px;font-weight:900;cursor:pointer;color:#dfe7ff}
.filter.active{background:linear-gradient(180deg,#7a8cff,#5b6dff);color:#fff;border-color:#6f82ff;box-shadow:0 8px 18px rgba(90,110,255,.25)}

/* Objetivo semanal (centrado) */
.goal-row{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:12px}
.goal-pill{justify-self:center;display:inline-flex;align-items:center;gap:8px;border:1px solid var(--chipLine);background:var(--chip);border-radius:999px;padding:8px 12px;font-weight:900}
.prog{height:16px;border-radius:999px;background:#0b1028;border:1px solid var(--line);overflow:hidden;position:relative}
.prog>span{position:absolute;left:0;top:0;height:100%;width:0;background:linear-gradient(90deg,#3be180,#76f4bc);transition:width .35s ease}
.prog em{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-weight:900;font-style:normal;color:#eafff6;text-shadow:0 1px 0 #0a0f28}
.reset{justify-self:end;display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border-radius:999px;border:1px solid #3a4998;background:#121b42;color:#dfe7ff;font-weight:900;cursor:pointer}

/* GRID 3√ó3 */
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;padding:14px}
@media(max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:620px){.grid{grid-template-columns:1fr}}

/* Tarjeta misi√≥n */
.card{position:relative;background:linear-gradient(180deg,#10183a,#0f1736);border:1px solid var(--line);border-radius:14px;padding:12px;min-height:168px;display:grid;grid-template-rows:auto auto 1fr auto;row-gap:8px;transition:transform .18s ease, box-shadow .18s ease}
.card:hover{transform:translateY(-2px);box-shadow:0 12px 24px rgba(20,30,70,.35)}
.meta-row{display:flex;align-items:center;gap:8px;flex-wrap:nowrap;overflow:hidden}
.chip{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid var(--chipLine);background:var(--chip);font-weight:900;white-space:nowrap}
.chip-xp::before{content:"‚ö°"}
.chip-cert.az{background:var(--az-soft)}
.chip-cert.aws{background:var(--aws-soft)}
.diff{display:inline-flex;align-items:center;gap:8px}
.diff i{width:10px;height:10px;border-radius:999px;display:inline-block}
.diff.easy i{background:#a8e6ff}
.diff.mid i{background:#ffd66b}
.diff.hard i{background:#ff8a8a}
.tit{font-weight:900}
.desc{color:var(--muted);font-size:.92rem}
.actions{display:flex;align-items:center;gap:10px}
.play{flex:1;display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 16px;height:40px;border-radius:12px;border:1px solid #4655a8;background:linear-gradient(180deg,#6677ff,#5a6df7);color:#fff;font-weight:900;cursor:pointer}
.del{width:40px;height:40px;border-radius:12px;border:1px solid #3a4998;background:#16204a;color:#cfe3ff;font-weight:900;cursor:pointer}

/* Cintas y transiciones */
.ribbon{position:absolute;right:-28px;bottom:14px;transform:rotate(-12deg);font-weight:900;padding:6px 30px;border-radius:10px;border:2px solid rgba(0,0,0,.15);box-shadow:0 8px 18px rgba(0,0,0,.25);display:none}
.card.win .ribbon{display:block;background:#3be180;color:#05361c}
.card.fail .ribbon{display:block;background:#ff8a8a;color:#3b0a0a}
.card.out{opacity:0;transform:scale(.92) translateY(8px);transition:opacity .35s ease, transform .35s ease}
.card.new{animation:pop .35s ease}
@keyframes pop{0%{opacity:0;transform:scale(.9)}100%{opacity:1;transform:scale(1)}}

/* Pop de XP y vuelo al ranking */
.fly{position:fixed;pointer-events:none;z-index:80;background:#1b8f5a;color:#fff;padding:8px 12px;border-radius:999px;font-weight:900;border:1px solid rgba(255,255,255,.2);box-shadow:0 8px 18px rgba(0,0,0,.35);opacity:0;transform:translateY(10px);transition:opacity .2s ease, transform .2s ease}
.fly.show{opacity:1;transform:translateY(0)}

/* Modal preguntas */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:60}
.modal.show{display:flex}
.modal-card{width:min(820px,92vw);max-height:86vh;overflow:auto;background:var(--panel2);border:1px solid var(--line);border-radius:16px;padding:18px}
.mhead{display:flex;justify-content:space-between;align-items:center;gap:14px;margin-bottom:10px}
.mprogress{font-weight:900;color:#cfe4ff}
.close{border:1px solid var(--line);background:#182152;color:#cfe1ff;border-radius:10px;padding:8px 12px;font-weight:900;cursor:pointer}
.qbox{background:#0f1736;border:1px solid var(--line);border-radius:12px;padding:14px}
.qtitle{font-weight:900;margin:0 0 10px}
.opt{display:grid;grid-template-columns:auto 1fr;column-gap:10px;align-items:start;margin:8px 0;padding:10px;border:1px solid var(--line);border-radius:10px;background:#0e1633;cursor:pointer}
.opt:hover{border-color:#3a4998}
.opt.correct{background:rgba(59,225,128,.10);border-color:rgba(59,225,128,.7)}
.opt.wrong{background:rgba(255,114,114,.10);border-color:rgba(255,114,114,.7)}

/* Ranking y recomendado */
.side{padding:12px;display:grid;gap:14px}
.rpanel{background:#0f1736;border:1px solid var(--line);border-radius:12px;padding:12px}
.rtitle{font-weight:900;margin-bottom:8px;display:flex;align-items:center;gap:8px}
.rlist{display:grid;gap:8px}
.rrow{display:grid;grid-template-columns:28px 1fr auto auto;gap:8px;align-items:center;background:#0f1736;border:1px solid #2d3a74;border-radius:12px;padding:8px 10px}
.rrow.me{outline:2px solid rgba(124,212,255,.6);box-shadow:0 0 0 6px rgba(124,212,255,.12) inset}
.rname{font-weight:800}
.pill{display:inline-flex;align-items:center;gap:6px;border:1px solid #3856a8;background:#12204c;border-radius:999px;padding:6px 10px;font-weight:900}

.links .item{display:flex;align-items:center;gap:10px;border:1px solid #2d3a74;background:#0f1736;border-radius:12px;padding:10px;margin-top:8px;text-decoration:none;color:#e8edff}
.links .item:hover{border-color:#556dff}

/* Reglas */
.rules{margin-top:16px}
.rule-btn{display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border-radius:12px;border:1px solid #3a4998;background:#121b42;color:#dfe7ff;font-weight:900;cursor:pointer}
.rule-body{display:none;margin-top:10px;padding:16px;background:linear-gradient(180deg,#0e1533,#0d1431);border:1px solid var(--line);border-radius:16px}
.rule-body.show{display:block}
</style>
</head>
<body>

<header>
  <div class="nav">
    <div class="brand">
      <span class="logo"></span>
      <span>IT <strong>Hub</strong> .es</span>
    </div>
    <div class="nav-right">
      <span class="badge">Arena Battle</span>
      <span class="badge">Lv. 9</span>
      <span class="badge">üî• 2d</span>
      <span class="user">BALLESTER21</span>
    </div>
  </div>
</header>

<main class="container">
  <h1>Arena Battle ‚Äì Quizzes Rel√°mpago</h1>
  <p class="lead">Elige certificaci√≥n, resuelve misiones y gana <b>XP</b>. <b>Cada 1000 XP</b> subes <b>+1 nivel</b>.</p>

  <div class="layout">
    <!-- TABLERO -->
    <section class="panel" id="arena">
      <div class="panel-head">
        <!-- L√≠nea 1 -->
        <div class="head-row">
          <div class="hint">üéØ Elige certificaci√≥n</div>
          <div class="filters" id="filters">
            <button class="filter active" data-cert="ALL">Todas</button>
            <button class="filter" data-cert="AZ-104">AZ-104</button>
            <button class="filter" data-cert="AZ-305">AZ-305</button>
            <button class="filter" data-cert="SAA-C03">SAA-C03</button>
          </div>
        </div>
        <!-- L√≠nea 2 -->
        <div class="goal-row">
          <span></span>
          <div class="goal-pill">üéØ <span id="goalTxt">51 / 70</span></div>
          <button id="btnReset" class="reset">RESET</button>
          <div class="prog" style="grid-column:1/4"><span id="goalBar" style="width:73%"></span><em id="goalPct">73%</em></div>
        </div>
      </div>

      <div class="grid" id="grid"><!-- tarjetas --></div>

      <!-- Reglas plegables -->
      <section class="rules" style="padding:12px">
        <button class="rule-btn" id="toggleRules">üìñ Ver Reglas del juego</button>
        <div class="rule-body" id="rulesBody">
          <h3>Reglas y puntuaci√≥n</h3>
          <ul>
            <li>Tablero <b>3√ó3</b> = 9 casillas. Cada casilla es una misi√≥n de 1‚Äì3 preguntas.</li>
            <li><b>XP</b> determina tu progreso y <b>nivel</b>. Cada <b>1000 XP = +1 nivel</b>.</li>
            <li>Dificultad: <span class="diff easy"><i></i></span> F√°cil ¬∑ <span class="diff mid"><i></i></span> Media ¬∑ <span class="diff hard"><i></i></span> Dif√≠cil. A m√°s dif√≠cil, m√°s XP.</li>
            <li>Debes acertar <b>todas las preguntas</b> para ganar los puntos de la misi√≥n.</li>
            <li>Si aciertas: aparece un pop <b>+XP</b>, la tarjeta se marca como <b>ACERTADA</b> y se reemplaza.</li>
            <li>Si fallas: ver√°s <b>FALLO</b> por 2 s; la misi√≥n permanece para reintentar.</li>
          </ul>
        </div>
      </section>
    </section>

    <!-- LATERAL: Ranking + Recomendado -->
    <aside class="panel">
      <div class="side">
        <div class="rpanel">
          <div class="rtitle">üèÜ Ranking tiempo real (Lv / XP)</div>
          <div class="rlist" id="rlist"><!-- filas --></div>
        </div>

        <div class="rpanel">
          <div class="rtitle">üîó Recomendado</div>
          <div class="links" id="reco">
            <a class="item" href="/score/ranking.html">üèÖ Ver ranking global</a>
            <a class="item" href="/content/azure-identity-az104.html">üß© Azure ¬∑ Identidad y Acceso</a>
            <a class="item" href="/content/azure-network-security-az104.html">üõ°Ô∏è Azure ¬∑ Seguridad en red</a>
            <a class="item" href="/certification/microsoft-azure/az-104/lz-azure-az-104.html">üß™ Simulador AZ-104</a>
          </div>
        </div>
      </div>
    </aside>
  </div>
</main>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="mTitle">
    <div class="mhead">
      <div class="mprogress" id="mProg">Pregunta 1/1</div>
      <div class="meta-row">
        <span class="chip chip-cert" id="mCert">AZ-104</span>
        <span class="chip diff" id="mDiff"><i></i><b>F√°cil</b></span>
        <span class="chip chip-xp" id="mXp">+10 XP</span>
      </div>
      <button class="close" id="mClose">CERRAR</button>
    </div>
    <div class="qbox">
      <h3 class="qtitle" id="mTitle">...</h3>
      <div id="mOpts"></div>
    </div>
  </div>
</div>

<!-- Pop de XP -->
<div class="fly" id="fly">+10 XP</div>

<script>
/* ===== Banco de preguntas ===== */
const BANK = {
  "AZ-104":[
    {domain:"Identidades",  q:"¬øQu√© servicio centraliza reglas de acceso a nivel de suscripci√≥n / grupo de recursos?", opts:["Azure Policy","Azure Blueprints","RBAC (roles)","PIM"], ok:2},
    {domain:"Red",          q:"Para exponer web multizona con TLS y WAF gestionado:", opts:["Traffic Manager","Application Gateway","Front Door","Load Balancer"], ok:2},
    {domain:"Almacenamiento",q:"¬øQu√© opci√≥n asegura WORM legalmente inmutable?", opts:["Soft delete","Versioning","Immutable Blob (Time-based)","GRS"], ok:2},
    {domain:"Conectividad", q:"Conectividad estable on-prem con SLA y BGP:", opts:["P2S","ExpressRoute","VNet Peering","S2S"], ok:1},
    {domain:"Acceso",       q:"Dar acceso temporal SSH sin abrir 22:", opts:["Bastion","JIT (Defender for Cloud)","NSG allow","IP p√∫blica temporal"], ok:1}
  ],
  "AZ-305":[
    {domain:"Gobernanza",   q:"Imponer etiquetado obligatorio y restringir regiones desde un Management Group:", opts:["RBAC","Azure Policy (iniciativa)","Defender for Cloud","Log Analytics"], ok:1},
    {domain:"Red",          q:"Hub global con inspecci√≥n centralizada + sedes:", opts:["VNet mesh","Virtual WAN + Hub seguro","AppGW en cada spoke","NVAs por spoke"], ok:1},
    {domain:"Datos",        q:"DB global con latencia ms y multi-master:", opts:["SQL MI","Cosmos DB","PostgreSQL Flex","SQL en VM"], ok:1},
    {domain:"Serverless",   q:"Procesar eventos de blobs sin servidores:", opts:["WebJobs","Functions + Event Grid","Service Fabric","Timer"], ok:1},
    {domain:"Per√≠metro",    q:"WAF+TLS global y enrutamiento al edge:", opts:["Traffic Manager","Azure Front Door","Load Balancer","AppGW B√°sico"], ok:1}
  ],
  "SAA-C03":[
    {domain:"Seguro",       q:"Secretos con rotaci√≥n y KMS integrado:", opts:["Secrets Manager","Parameter Store","S3 SSE-S3","CloudHSM"], ok:0},
    {domain:"Red",          q:"Acceso a S3 sin Internet desde VPC:", opts:["Gateway VPC Endpoint","Interface Endpoint","NAT GW","IGW"], ok:0},
    {domain:"Eventos",      q:"Publicar eventos a muchos consumidores:", opts:["SQS FIFO","SNS fanout","S3 events","Kinesis FH"], ok:1},
    {domain:"Base de datos",q:"DB multi-AZ con failover autom√°tico:", opts:["RDS Multi-AZ","Aurora Serverless v2","DynamoDB Global","Read Replica"], ok:0},
    {domain:"CDN",          q:"CDN global con TLS y protecci√≥n b√°sica:", opts:["ALB","CloudFront","NLB","Global Accelerator"], ok:1}
  ]
};

/* ===== Recompensas por dificultad ===== */
const DIFFS = [
  {label:"F√°cil",  class:"easy",  xp:10,  qcount:1},
  {label:"Media",  class:"mid",   xp:22,  qcount:2},
  {label:"Dif√≠cil",class:"hard",  xp:36,  qcount:3},
];

let filterCert = "ALL";
let weekly = JSON.parse(localStorage.getItem("weeklyProgress")||"51"); // demo
const GRID_SIZE = 9; // 3√ó3

/* ===== Utils ===== */
const rand = (min,max)=> Math.floor(Math.random()*(max-min+1))+min;
const pickN = (arr,n)=>{ const a=[...arr],out=[]; while(out.length<n && a.length){ out.push(a.splice(rand(0,a.length-1),1)[0]); } return out; };

/* ===== DOM ===== */
const grid=document.getElementById('grid');
const goalTxt=document.getElementById('goalTxt');
const goalBar=document.getElementById('goalBar');
const goalPct=document.getElementById('goalPct');
const rulesBtn=document.getElementById('toggleRules');
const rulesBody=document.getElementById('rulesBody');
const fly=document.getElementById('fly');

/* ===== Objetivo semanal ===== */
function updateGoal(v){
  weekly=Math.min(70,Math.max(0,v));
  localStorage.setItem("weeklyProgress",weekly);
  const pct=Math.round((weekly/70)*100);
  goalTxt.textContent=`${weekly} / 70`;
  goalBar.style.width=`${pct}%`;
  goalPct.textContent=`${pct}%`;
}

/* ===== Misiones ===== */
function sampleMission(cert){
  const certPool = cert==="ALL"?Object.keys(BANK):[cert];
  const c = certPool[rand(0, certPool.length-1)];
  const diff = DIFFS[rand(0,DIFFS.length-1)];
  const qs = pickN(BANK[c], diff.qcount);
  return {cert:c, qs, diff};
}
function certClass(cert){ return (cert==="SAA-C03")?"aws":"az"; }

function createCard(m){
  const card=document.createElement('article');
  card.className='card new';
  card.dataset.cert=m.cert;
  const diff = m.diff;

  card.innerHTML=`
    <div class="meta-row">
      <span class="chip chip-cert ${certClass(m.cert)}">${m.cert}</span>
      <span class="chip diff ${diff.class}"><i></i>${diff.label}</span>
      <span class="chip chip-xp">+${diff.xp} XP</span>
    </div>
    <div class="tit">${m.cert} ¬∑ ${m.qs[0].domain}</div>
    <div class="desc">${diff.qcount} ${diff.qcount===1?'pregunta':'preguntas'} ¬∑ acierta todas para puntuar</div>
    <div class="actions">
      <button class="play">JUGAR</button>
      <button class="del" title="Quitar">‚úñ</button>
    </div>
    <div class="ribbon">ACERTADA</div>
  `;
  card.querySelector('.play').addEventListener('click',()=>openMission(card,m));
  card.querySelector('.del').addEventListener('click',()=>{
    card.classList.add('out');
    setTimeout(()=>{ card.replaceWith(createCard(sampleMission(filterCert==="ALL"?"ALL":card.dataset.cert))); },350);
  });
  return card;
}

function buildGrid(){
  grid.innerHTML="";
  for(let i=0;i<GRID_SIZE;i++) grid.appendChild(createCard(sampleMission(filterCert)));
}

/* ===== Modal flow ===== */
const modal=document.getElementById('modal');
const mClose=document.getElementById('mClose');
const mTitle=document.getElementById('mTitle');
const mCert=document.getElementById('mCert');
const mDiff=document.getElementById('mDiff');
const mXp=document.getElementById('mXp');
const mProg=document.getElementById('mProg');
const mOpts=document.getElementById('mOpts');

let activeCard=null, activeMission=null, idxQ=0;

function openMission(card,m){
  activeCard=card; activeMission=m; idxQ=0;
  mCert.textContent=m.cert;
  mCert.className=`chip chip-cert ${certClass(m.cert)}`;
  mDiff.className=`chip diff ${m.diff.class}`;
  mDiff.innerHTML=`<i></i><b>${m.diff.label}</b>`;
  mXp.textContent = `+${m.diff.xp} XP`;
  renderQ();
  modal.classList.add('show');
}

function renderQ(){
  const q=activeMission.qs[idxQ];
  mProg.textContent=`Pregunta ${idxQ+1}/${activeMission.diff.qcount}`;
  mTitle.textContent=q.q;
  mOpts.innerHTML="";
  q.opts.forEach((t,ix)=>{
    const el=document.createElement('label');
    el.className='opt';
    el.innerHTML=`<input type="radio" name="opt" value="${ix}"> <span>${t}</span>`;
    el.addEventListener('click',()=>{
      const correct=(ix===q.ok);
      [...mOpts.children].forEach((o,i)=>{
        o.classList.toggle('correct', i===q.ok);
        if(i===ix && !correct) o.classList.add('wrong');
      });
      setTimeout(()=>{
        if(!correct){ onFail(); }
        else if(idxQ<activeMission.qs.length-1){ idxQ++; renderQ(); }
        else{ onWin(); }
      },350);
    });
    mOpts.appendChild(el);
  });
}

function onWin(){
  modal.classList.remove('show');
  activeCard.classList.add('win');
  const btn=activeCard.querySelector('.play'); btn.setAttribute('disabled','true');

  // pop + vuelo al ranking
  showFly(`+${activeMission.diff.xp} XP`, activeCard);

  updateGoal(weekly+activeMission.diff.qcount);
  setTimeout(()=>{
    activeCard.classList.add('out');
    setTimeout(()=>{
      const parent=activeCard.parentElement;
      const certHere=filterCert==="ALL"?"ALL":activeCard.dataset.cert;
      activeCard.remove();
      parent.appendChild(createCard(sampleMission(certHere)));
    },400);
  },1300);
}
function onFail(){
  modal.classList.remove('show');
  activeCard.classList.add('fail');
  activeCard.querySelector('.ribbon').textContent='FALLO';
  const btn=activeCard.querySelector('.play'); btn.setAttribute('disabled','true');
  setTimeout(()=>{ activeCard.classList.remove('fail'); btn.removeAttribute('disabled'); },2000);
}

/* ===== Fly to ranking ===== */
function showFly(text, fromCard){
  fly.textContent=text;
  const rect=fromCard.getBoundingClientRect();
  fly.style.left = (rect.left + rect.width/2 - 40) + 'px';
  fly.style.top  = (rect.top - 10) + 'px';
  fly.classList.add('show');

  // destino: panel ranking (aprox esquina sup derecha del lateral)
  const side = document.querySelector('.side .rpanel');
  const dst = side.getBoundingClientRect();
  const dx = (dst.left + dst.width/2) - (rect.left + rect.width/2);
  const dy = (dst.top + 10) - (rect.top - 10);

  // transici√≥n m√°s lenta y visible
  fly.animate([
    { transform:'translate(0,0)', opacity:1 },
    { transform:`translate(${dx}px, ${dy}px)`, opacity:0.15 }
  ], { duration:1200, easing:'cubic-bezier(.22,.85,.29,.99)' })
  .onfinish = ()=> fly.classList.remove('show');

  // sumar XP a un jugador aleatorio (fake realtime)
  bumpRandomXP(activeMission.diff.xp);
}

/* ===== Ranking ===== */
const players=[
  {name:"CloudNinja", level:11, xp:10444},
  {name:"AKS_Master", level:10, xp:9685},
  {name:"S3Wizard", level:10, xp:9457},
  {name:"Ballester21", level:9,  xp:8548, me:true},
  {name:"NetSecX", level:8,  xp:7631},
  {name:"DataKnight", level:8, xp:7412},
  {name:"KubePilot",  level:7, xp:6890},
  {name:"RouteGuru",  level:7, xp:6720},
  {name:"OpsRanger",  level:6, xp:6120},
  {name:"EdgeFox",    level:6, xp:6015},
];
const rlist=document.getElementById('rlist');

function renderRanking(){
  players.sort((a,b)=> b.xp - a.xp);
  rlist.innerHTML="";
  players.forEach((p,i)=>{
    const row=document.createElement('div');
    row.className='rrow'+(p.me?' me':'');
    row.innerHTML=`
      <div>${i+1}</div>
      <div class="rname">${p.name}</div>
      <div class="pill">Lv ${p.level}</div>
      <div class="pill">‚ö° ${p.xp}</div>`;
    rlist.appendChild(row);
  });
}
function bumpRandomXP(amount){
  const idx = Math.floor(Math.random()*players.length);
  players[idx].xp += amount;
  while(players[idx].xp >= (players[idx].level*1000)){
    players[idx].level += 1;
  }
  renderRanking();
}
// ticker liviano
setInterval(()=>{ bumpRandomXP(rand(5,25)); }, 2500);

/* ===== UI wiring ===== */
document.getElementById('filters').addEventListener('click', e=>{
  const b=e.target.closest('.filter'); if(!b) return;
  document.querySelectorAll('.filter').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  filterCert=b.dataset.cert;
  buildGrid();
});
document.getElementById('btnReset').addEventListener('click', ()=>{ updateGoal(0); buildGrid(); });

document.getElementById('mClose').addEventListener('click',()=>modal.classList.remove('show'));
modal.addEventListener('click',e=>{ if(e.target===modal) modal.classList.remove('show'); });

rulesBtn.addEventListener('click', ()=>{
  rulesBody.classList.toggle('show');
  rulesBtn.textContent = rulesBody.classList.contains('show') ? "üìñ Ocultar Reglas" : "üìñ Ver Reglas del juego";
  if(rulesBody.classList.contains('show')){
    rulesBody.scrollIntoView({behavior:'smooth', block:'start'});
  }
});

/* ===== INIT ===== */
updateGoal(weekly);
buildGrid();
renderRanking();
</script>
</body>
</html>
