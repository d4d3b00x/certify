<footer role="contentinfo" style="border-top:1px solid var(--stroke);padding:24px 0;color:#9ca8d9;background:linear-gradient(180deg,rgba(22,27,45,.6),rgba(22,27,45,.2))">
  <div class="container f-grid" style="display:grid;gap:14px">
    <div>
      <div class="brand" style="text-transform:none;display:flex;align-items:center;gap:10px;font-weight:900">
        <span aria-hidden="true" style="width:18px;height:34px;border-radius:10px;background:linear-gradient(180deg,#8aa0ff 0%,#425dff 100%);box-shadow:0 0 0 6px rgba(108,139,255,.18)"></span>
        <span>ITHUB.ES</span>
      </div>
      <p style="margin:8px 0 0;">Aprende, practica y aprueba tus certificaciones IT mientras compites con el resto del mundo.<br><br>Todo lo que necesitas en un sÃ³lo lugar.</p>
    </div>

    <div>
      <div style="font-weight:800">SIMULADORES</div>
      <div><a href="/certification/microsoft-azure/az-104/lz-azure-az-104.html">MICROSOFT AZURE AZ-104</a></div>
      <div><a href="/certification/microsoft-azure/az-305/lz-azure-az-305.html">MICROSOFT AZURE AZ-305</a></div>
      <div><a href="/certification/amazon aws/aws-saa-c03/lz-aws-saa-c03.html">AMAZON AWS SAA-C03</a></div>
    </div>

    <div>
      <div style="font-weight:800">DESTACADOS</div>
      <div><a href="/content/azure-identity-az104.html">Azure Â· Identidad y Acceso</a></div>
      <div><a href="/content/azure-network-security-az104.html">Azure Â· Seguridad en la red</a></div>
      <div><a href="/content/azure-cost-governance-az104.html">Azure Â· Coste y Gobernanza</a></div>
      <div><a href="/content/azure-landing-zone.html">Azure Â· Landing Zone</a></div>
      <div><a href="/content/aws-compute-elasticity-saac03.html">AWS Â· Elasticidad EC2</a></div>
    </div>

    <div>
      <div style="font-weight:800">COLABORADORES</div>
      ðŸ’¬ <span><a href="https://mundoazure.cloud" target="_blank" rel="noopener">https://mundoazure.cloud</a></span><br><br>

      <div style="font-weight:800">CONTACTO</div>
      <button id="footerContactBtn" type="button"
              style="background:none;border:none;color:#cfe1ff;font-weight:800;display:inline-flex;align-items:center;gap:6px;cursor:pointer;padding:0;margin-top:6px;">
        ðŸ’¬ <span>ContÃ¡ctanos</span>
      </button>
    </div>
  </div>

  <div class="container" style="margin-top:12px;font-size:12px;">Â© <span id="footer-year"></span> ITHub.es</div>

  <!-- ===== Modal incrustado (lo moveremos al <body>) ===== -->
  <div class="ithub-modal" id="ithub-feedback-modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="fbTitle" style="display:none">
    <div class="fb-card" role="document" tabindex="-1">
      <h3 id="fbTitle">ðŸ’¬ ENVIAR FEEDBACK</h3>
      <p class="muted">CuÃ©ntanos quÃ© mejorar o quÃ© funcionalidades quieres ver.</p>

      <label class="visually-hidden" for="fbEmail">Email (opcional)</label>
      <input id="fbEmail" type="email" placeholder="Tu email (opcional)">

      <label class="visualmente-hidden" for="fbText">Texto de feedback</label>
      <textarea id="fbText" placeholder="Escribe aquÃ­ tu sugerenciaâ€¦"></textarea>

      <div id="fbStatus" class="fb-status" aria-live="polite"></div>

      <div class="row">
        <button class="btn" id="btnCancelFeedback" type="button">CANCELAR</button>
        <button class="pill-btn" id="btnSendFeedback" type="button">ENVIAR</button>
        <button class="pill-btn" id="btnOkFeedback" type="button" style="display:none">ACEPTAR</button>
      </div>

      <button class="x" id="btnX" aria-label="Cerrar">âœ•</button>
    </div>
  </div>

  <style>
    /* Fallbacks bÃ¡sicos */
    .container{max-width:1100px;margin:0 auto;padding:0 20px}
    a{text-decoration:none}
    a:hover{text-decoration:underline}

    footer{
      border-top:1px solid var(--stroke, #283056);
      padding:24px 0;
      color:#9ca8d9;
      background:linear-gradient(180deg,rgba(22,27,45,.6),rgba(22,27,45,.2))
    }
    .f-grid{display:grid;gap:14px}
    @media(min-width:720px){.f-grid{grid-template-columns:1.2fr .8fr .8fr .8fr}}
    footer a{color:#cfe1ff}

    /* ===== Modal: opaco, por encima de todo y aislado de efectos globales ===== */
    #ithub-feedback-modal.show{display:flex;}
    #ithub-feedback-modal{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:16px;
      background:rgba(0,0,0,.9) !important;  /* fondo oscuro sÃ³lido */
      z-index:2147483647 !important;         /* por encima de cualquier overlay */
      -webkit-backdrop-filter:none !important;
      backdrop-filter:none !important;
      isolation:isolate;                     /* evita mezclas raras */
      mix-blend-mode:normal !important;
    }

    /* Blindaje anti-opacidad/filters heredados */
    #ithub-feedback-modal, #ithub-feedback-modal *{
      opacity:1 !important;
      filter:none !important;
      mix-blend-mode:normal !important;
    }

    /* Tarjeta del modal (clase Ãºnica) */
    #ithub-feedback-modal .fb-card{
      width:min(760px,100%); max-height:88vh; overflow:auto;
      background:#161b2d !important;          /* sÃ³lido */
      border:1px solid var(--stroke,#3a4580) !important;
      border-radius:14px; padding:18px; color:var(--ink,#e8ecff);
      box-shadow:0 20px 60px rgba(0,0,0,.6) !important;
      position:relative;
    }

    #ithub-feedback-modal h3{margin:0 0 10px;font-size:1.2rem;}
    #ithub-feedback-modal .muted{color:var(--muted,#9ca8d9);margin:0 0 10px;}

    #ithub-feedback-modal input,
    #ithub-feedback-modal textarea,
    #ithub-feedback-modal select{
      width:100%;
      border:1px solid var(--stroke,#283056) !important;
      border-radius:10px;
      background:#1b2140 !important;         /* inputs sÃ³lidos */
      color:var(--ink,#e8ecff) !important;
      padding:10px;
      font-weight:700;
    }
    #ithub-feedback-modal textarea{min-height:130px;resize:vertical;}

    #ithub-feedback-modal .row{display:flex;gap:8px;justify-content:flex-end;margin-top:10px;}
    #ithub-feedback-modal .btn{
      display:inline-flex;align-items:center;justify-content:center;min-height:44px;height:40px;
      padding:0 14px;border-radius:12px;border:1px solid var(--stroke,#283056);background:transparent;
      color:var(--ink,#e8ecff);font-weight:900;cursor:pointer;text-transform:uppercase;
    }
    #ithub-feedback-modal .btn:hover{border-color:#3a4580;}

    #ithub-feedback-modal .pill-btn{
      display:inline-flex;align-items:center;justify-content:center;min-width:88px;min-height:44px;height:34px;
      padding:0 12px;border-radius:10px;border:1px solid #3b2fff44;
      background:linear-gradient(180deg,#7a67ff,#5f48ff);
      color:#fff;font-weight:900;cursor:pointer;text-transform:uppercase;
    }
    #ithub-feedback-modal .pill-btn:hover{
      background:linear-gradient(180deg,#8a78ff,#6b54ff);transform:translateY(-1px);
    }

    #ithub-feedback-modal .fb-status{margin-top:8px;font-weight:800;}
    #ithub-feedback-modal .fb-status.ok{color:var(--ok,#3ad97a);}
    #ithub-feedback-modal .fb-status.err{color:var(--bad,#ff6b6b);}
    #ithub-feedback-modal .fb-status.info{color:var(--muted,#9ca8d9);}

    #ithub-feedback-modal .x{
      position:absolute;top:10px;right:10px;background:none;border:0;color:var(--muted,#9ca8d9);font-size:18px;cursor:pointer;
    }
    .visually-hidden{position:absolute;left:-9999px;}
  </style>

  <script>
  (function(){
    const API_BASE = 'https://uougu1cm26.execute-api.eu-central-1.amazonaws.com';
    const NOTES_ENDPOINT = API_BASE + '/items';
    const MODAL_ID = 'ithub-feedback-modal';
    const $ = (sel, root=document) => root.querySelector(sel);

    // AÃ±o en el footer
    try { document.currentScript.parentElement.querySelector('#footer-year').textContent = new Date().getFullYear(); } catch {}

    /* ===== Focus trap ===== */
    function trapFocus(container){
      function handler(e){
        if(e.key !== 'Tab') return;
        const focusables = container.querySelectorAll('a[href],button:not([disabled]),input,select,textarea,[tabindex]:not([tabindex="-1"])');
        const list = Array.from(focusables).filter(el => el.offsetParent !== null);
        if(!list.length) return;
        const first = list[0], last = list[list.length-1];
        if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
        else if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
      }
      container.__trapHandler = handler;
      container.addEventListener('keydown', handler);
    }
    function releaseTrap(container){
      if(container.__trapHandler){ container.removeEventListener('keydown', container.__trapHandler); container.__trapHandler = null; }
    }

    /* ===== Control modal ===== */
    let lastFocus = null;
    function openModal(){
      const modal = document.getElementById(MODAL_ID);
      if(!modal) return;

      // Pre-cargar email si hay currentUser
      try{
        const u = JSON.parse(localStorage.getItem('currentUser')||'null');
        if(u && u.email) $('#fbEmail', modal).value = u.email;
      }catch{}

      lastFocus = document.activeElement;
      modal.style.display = 'flex';
      modal.classList.add('show');
      modal.setAttribute('aria-hidden','false');
      (modal.querySelector('.fb-card') || modal).focus();
      trapFocus(modal);
      document.addEventListener('keydown', escCloser);

      // Reset UI
      $('#fbEmail', modal).disabled = false;
      $('#fbText', modal).disabled  = false;
      $('#btnSendFeedback', modal).disabled = false;
      const st = $('#fbStatus', modal); st.textContent = ''; st.className = 'fb-status';
      $('#btnSendFeedback', modal).style.display = '';
      $('#btnCancelFeedback', modal).style.display = '';
      $('#btnOkFeedback', modal).style.display = 'none';
    }

    function closeModal(){
      const modal = document.getElementById(MODAL_ID);
      if(!modal) return;
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden','true');
      modal.style.display = 'none';
      document.removeEventListener('keydown', escCloser);
      releaseTrap(modal);
      if(lastFocus) try{ lastFocus.focus(); }catch{}
    }

    function escCloser(e){ if(e.key === 'Escape') closeModal(); }

    /* ===== EnvÃ­o ===== */
    async function sendFeedback(){
      const modal = document.getElementById(MODAL_ID);
      const email = $('#fbEmail', modal).value.trim();
      const message = $('#fbText', modal).value.trim();
      const status = $('#fbStatus', modal);

      if(!message){
        status.textContent = 'Por favor, escribe tu sugerencia.';
        status.className = 'fb-status err';
        return;
      }

      $('#fbEmail', modal).disabled = true;
      $('#fbText', modal).disabled  = true;
      $('#btnSendFeedback', modal).disabled = true;

      status.textContent = 'Enviandoâ€¦';
      status.className = 'fb-status info';

      const id = (crypto && crypto.randomUUID) ? crypto.randomUUID() : ('note_' + Date.now());
      let userId = null;
      try{
        const u = JSON.parse(localStorage.getItem('currentUser')||'null');
        userId = u?.id || u?.email || null;
      }catch{}

      const note = {
        id,
        type: 'feedback',
        title: 'Feedback web ITHub',
        message,
        email: email || null,
        userId,
        path: location.pathname + location.search,
        ua: navigator.userAgent,
        createdAt: new Date().toISOString()
      };

      const params = new URLSearchParams();
      params.set('table','notes');
      params.set('id', id);
      params.set('content', JSON.stringify(note));

      const ctl = new AbortController();
      const timeoutId = setTimeout(()=>ctl.abort(), 10000);

      try{
        const res = await fetch(NOTES_ENDPOINT, { method:'POST', body:params, signal:ctl.signal });
        clearTimeout(timeoutId);

        if(!res.ok){
          const text = await res.text().catch(()=> '');
          throw new Error('HTTP ' + res.status + ' ' + text);
        }

        status.textContent = 'Â¡Gracias! Mensaje recibido ðŸ‘Œ';
        status.className = 'fb-status ok';
        $('#btnSendFeedback', modal).style.display = 'none';
        $('#btnCancelFeedback', modal).style.display = 'none';
        $('#btnOkFeedback', modal).style.display = '';
        $('#btnOkFeedback', modal).focus();
      }catch(err){
        console.error('Error guardando feedback:', err);
        status.textContent = 'No se pudo enviar la info. :(';
        status.className = 'fb-status err';
        $('#btnSendFeedback', modal).style.display = 'none';
        $('#btnCancelFeedback', modal).style.display = 'none';
        $('#btnOkFeedback', modal).style.display = '';
        $('#btnOkFeedback', modal).focus();
      }
    }

    /* ===== Wireup ===== */
    (function wire(){
      const modal = document.getElementById(MODAL_ID);
      if(!modal) return;

      // Mover el modal al <body> para evitar heredar opacidades del footer
      try { if (modal.parentElement !== document.body) document.body.appendChild(modal); } catch {}

      document.getElementById('footerContactBtn')?.addEventListener('click', openModal);
      modal.querySelector('#btnCancelFeedback')?.addEventListener('click', closeModal);
      modal.querySelector('#btnOkFeedback')?.addEventListener('click', closeModal);
      modal.querySelector('#btnX')?.addEventListener('click', closeModal);
      modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
      modal.querySelector('#btnSendFeedback')?.addEventListener('click', sendFeedback);

      // API pÃºblica y compatibilidad con 'ithub:contact'
      window.openFeedbackModal = openModal;
      window.addEventListener('ithub:contact', openModal);
    })();
  })();
  </script>
</footer>
