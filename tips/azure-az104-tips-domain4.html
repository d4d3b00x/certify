<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AZ-104 ‚Äî Dominio 4 ¬∑ Configurar y administrar redes virtuales</title>
  <style>
    :root{
      --bg:#0b1020;--card:#111a3a;--border:#2a3b82;--text:#e8edff;--muted:#a7b4ff;
      --accent:#7ac7ff;--pink:#ff6ac1;--green:#6af7c0;--yellow:#ffd15c;--red:#ff9b9b;
      --blue:#74a8ff;--purple:#c59cff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:radial-gradient(1200px 600px at 10% -10%,#141a3c 0,#0b1020 50%,#070b18 100%);
      color:var(--text);
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      line-height:1.65;
    }
    a{color:var(--accent)}
    .wrap{max-width:1000px;margin:0 auto;padding:28px}
    .badge{
      display:inline-flex;align-items:center;gap:10px;
      border:1px solid var(--border);
      background:linear-gradient(180deg,#0f1844,#0d1438);
      padding:8px 14px;
      border-radius:999px;
      font-weight:900;
      color:#cbd6ff;
      box-shadow:0 0 0 3px #00000044;
    }
    h1{margin:10px 0 10px;font-size:1.9rem}
    h2{margin:22px 0 10px;font-size:1.25rem}
    .muted{color:var(--muted)}
    .card{
      background:linear-gradient(180deg,#101a48,#0d1538);
      border:1px solid var(--border);
      border-radius:14px;
      padding:16px;
      margin:12px 0;
      box-shadow:0 6px 32px #00000055;
    }
    ul{padding-left:18px;margin:6px 0}
    li+li{margin-top:6px}
    .ok{color:var(--green)}
    .warn{color:var(--yellow)}
    .bad{color:var(--red)}
    code,.mono{
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
    }
    .toc{
      background:linear-gradient(180deg,#0f1a4a,#0b1230);
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px;
      margin:12px 0;
      display:grid;
      gap:6px;
    }
    .toc a{color:#e3ecff;text-decoration:none}
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:12px;
    }
    .kicker{
      font-size:.85rem;
      letter-spacing:.06em;
      color:#cfd6ff;
      text-transform:uppercase;
    }
    .pill{
      display:inline-block;
      font-size:.75rem;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#0e1740;
      margin-right:6px;
    }
    .hl{
      background:linear-gradient(90deg,#1c245c,#191f4a);
      border-left:3px solid var(--accent);
      padding:10px;
      border-radius:10px;
    }
    .note{
      background:linear-gradient(180deg,#102f38,#0b2025);
      border:1px solid #2a5f6a;
    }
    .tip{
      background:linear-gradient(180deg,#163310,#10230b);
      border:1px solid #2a6a2a;
    }
    .warnbox{
      background:linear-gradient(180deg,#3a1b1b,#2a1010);
      border:1px solid #7a2a2a;
    }
    kbd{
      border:1px solid #3a4a88;
      border-bottom-width:3px;
      border-radius:6px;
      padding:1px 6px;
      background:#0e1640;
    }
    pre{
      background:#0a122e;
      border:1px solid #26336e;
      border-radius:12px;
      padding:12px;
      overflow:auto;
    }
    .footer{
      color:#aab7ff;
      font-size:.9rem;
      margin-top:22px;
    }
    .small{font-size:.9rem}
    strong{font-weight:600}
  </style>
</head>
<body>
<div class="wrap">
  <span class="badge">Azure ¬∑ Redes</span>
  <h1>AZ-104 ‚Äî Dominio 4 ¬∑ Configurar y administrar redes virtuales</h1>
  <p class="muted">
    Este dominio es el ‚Äúcableado‚Äù de Azure: VNets, subredes, NSG, peering, VPN, ExpressRoute, Private Link y balanceo de carga.
    Si entiendes c√≥mo fluye el tr√°fico y d√≥nde se filtra, est√°s en muy buena posici√≥n.
  </p>

  <div class="toc">
    <div class="kicker">√çndice r√°pido para estudiar</div>
    <div class="grid">
      <a href="#conceptos">Conceptos clave</a>
      <a href="#decision">Gu√≠a de decisi√≥n</a>
      <a href="#comandos">Comandos y portal</a>
      <a href="#escenarios">Escenarios tipo examen</a>
      <a href="#errores">Errores t√≠picos</a>
      <a href="#cross">Cross-links con otros dominios</a>
    </div>
  </div>

  <div class="card" id="conceptos">
    <h2>Conceptos clave</h2>
    <ul>
      <li>
        <strong>VNets y subredes</strong><br>
        <span class="small">
          <ul>
            <li>Rangos <strong>CIDR</strong> sin solaparse (muy t√≠pico que el examen te ‚Äútiente‚Äù con solapes con on-prem).</li>
            <li>Subredes por funci√≥n: front, app, data, gesti√≥n‚Ä¶</li>
            <li>Delegaci√≥n de subredes para ciertos servicios PaaS.</li>
          </ul>
          Si ves problemas de conectividad extra√±os, revisa primero IPs, m√°scaras y solapes.
        </span>
      </li>
      <li>
        <strong>NSG y ASG</strong><br>
        <span class="small">
          <ul>
            <li><strong>NSG</strong>: firewall b√°sico L4, aplicado a subred y/o NIC.</li>
            <li><strong>ASG</strong>: agrupaci√≥n l√≥gica de NICs para usar como origen/destino en reglas.</li>
          </ul>
          Reglas se procesan por prioridad (n√∫mero m√°s bajo, m√°s importante) y por direcci√≥n (inbound/outbound).
        </span>
      </li>
      <li>
        <strong>Rutas (UDR) y BGP</strong><br>
        <span class="small">
          <ul>
            <li><strong>System routes</strong>: lo que Azure pone por defecto.</li>
            <li><strong>User-defined routes (UDR)</strong>: para forzar tr√°fico a ir por un firewall/NVA (forced tunneling).</li>
            <li><strong>BGP</strong>: en ExpressRoute y algunas VPN avanzadas, para intercambio din√°mico de rutas.</li>
          </ul>
          Pregunta t√≠pica: ‚Äútodo el tr√°fico Internet debe pasar por un firewall central‚Äù ‚Üí UDR + next hop al firewall.
        </span>
      </li>
      <li>
        <strong>Peering de VNets</strong><br>
        <span class="small">
          Permite que dos VNets hablen como si fueran la misma red, pero:
          <ul>
            <li>No hay <strong>tr√°nsito</strong> autom√°tico (hub-&amp;-spoke: los spokes no se ven entre s√≠ a trav√©s del hub por defecto).</li>
            <li>Debes evitar solapes de espacio de direcciones.</li>
          </ul>
        </span>
      </li>
      <li>
        <strong>Private Link y Service Endpoints</strong><br>
        <span class="small">
          <ul>
            <li><strong>Service endpoints</strong>: el tr√°fico hacia el servicio PaaS sale por la red de Microsoft; la IP del servicio sigue siendo p√∫blica.</li>
            <li><strong>Private Endpoints</strong>: IP privada en tu VNet para el servicio PaaS, con DNS privado asociado.</li>
          </ul>
          En el examen, cuando hablen de ‚Äúno exponer servicio en Internet‚Äù ‚Üí Private Endpoints &gt; Service Endpoints.
        </span>
      </li>
      <li>
        <strong>Conectividad h√≠brida: VPN y ExpressRoute</strong><br>
        <span class="small">
          <ul>
            <li><strong>VPN S2S</strong>: por Internet (IPsec), m√°s barato pero con latencia variable.</li>
            <li><strong>VPN P2S</strong>: para usuarios remotos.</li>
            <li><strong>ExpressRoute</strong>: circuito privado, m√°s estable y con mejores SLAs.</li>
            <li>Muchas arquitecturas usan <strong>ER + VPN como backup</strong>.</li>
          </ul>
        </span>
      </li>
      <li>
        <strong>Balanceadores: Load Balancer y Application Gateway</strong><br>
        <span class="small">
          <ul>
            <li><strong>Azure Load Balancer</strong>: L4 (TCP/UDP), perfecto para VMs y VMSS a nivel de puerto/IP.</li>
            <li><strong>Application Gateway</strong>: L7 (HTTP/HTTPS), soporta <em>path-based routing</em>, offload SSL y WAF.</li>
          </ul>
          Si la pregunta menciona WAF, HTTPS, rutas por URL ‚Üí App Gateway.  
          Si habla de puertos y protocolos sencillos ‚Üí Load Balancer.
        </span>
      </li>
      <li>
        <strong>DNS en Azure</strong><br>
        <span class="small">
          <ul>
            <li><strong>Azure DNS</strong>: zonas p√∫blicas.</li>
            <li><strong>Private DNS zones</strong>: nombres privados para recursos internos (y Private Endpoints).</li>
            <li>Importante en Private Link: usar las zonas <code>privatelink.&lt;service&gt;.azure.com</code>.</li>
          </ul>
        </span>
      </li>
    </ul>

    <div class="hl note" style="margin-top:10px">
      <span class="pill">üìò Tip del examen</span>
      En cada pregunta de redes, identifica: <strong>origen, destino, camino previsto y qu√© lo podr√≠a estar bloqueando</strong>
      (NSG, UDR, DNS, firewall‚Ä¶).
    </div>
  </div>

  <div class="card" id="decision">
    <h2>Gu√≠a de decisi√≥n r√°pida</h2>
    <ul>
      <li>
        <strong>‚ÄúNecesito segmentar mi aplicaci√≥n en capas‚Äù</strong><br>
        <span class="small">
          ‚Üí VNet √∫nica con <strong>varias subredes</strong> (web, app, data) + NSG espec√≠ficos por capa.
        </span>
      </li>
      <li>
        <strong>‚ÄúTodas las salidas a Internet deben pasar por un firewall central‚Äù</strong><br>
        <span class="small">
          ‚Üí Arquitectura <strong>hub-&amp;-spoke</strong> con firewall en el hub + <strong>UDR con next hop al firewall</strong>.
        </span>
      </li>
      <li>
        <strong>‚ÄúQuiero exponer una web con protecci√≥n WAF‚Äù</strong><br>
        <span class="small">
          ‚Üí <strong>Application Gateway v2 + WAF</strong>, con listeners HTTPS y redirecciones HTTP‚ÜíHTTPS.
        </span>
      </li>
      <li>
        <strong>‚ÄúQuiero conectar on-prem con Azure de forma estable y privada‚Äù</strong><br>
        <span class="small">
          ‚Üí <strong>ExpressRoute</strong>.  
          Si piden alta disponibilidad ‚Üí 2 circuitos o ER + VPN de backup.
        </span>
      </li>
      <li>
        <strong>‚ÄúQuiero que un Storage / SQL PaaS no sea accesible por Internet‚Äù</strong><br>
        <span class="small">
          ‚Üí <strong>Private Endpoints</strong> + DNS privado + deshabilitar acceso p√∫blico en el servicio.
        </span>
      </li>
    </ul>

    <div class="hl tip" style="margin-top:10px">
      <span class="pill">üéØ Estrategia</span>
      Cuando dudes, piensa si el problema es de <strong>segmentaci√≥n</strong>, <strong>seguridad</strong>,
      <strong>h√≠brido</strong> o <strong>publicaci√≥n externa</strong>.  
      Eso ya te encamina a subredes/NSG, UDR/firewall, VPN/ER o LB/AppGW.
    </div>
  </div>

  <div class="card" id="comandos">
    <h2>Comandos y rutas de portal</h2>
    <div class="grid">
      <div class="card" style="background:#0c1332">
        <div class="kicker">Crear VNet + Subred</div>
        <pre><code>az network vnet create \
  -g rg-demo \
  -n vnet-app \
  --address-prefixes 10.10.0.0/16 \
  --subnet-name web \
  --subnet-prefix 10.10.1.0/24</code></pre>
        <p class="small">
          Portal: <strong>Virtual networks &gt; Create</strong>.  
          Revisa siempre rangos para evitar solapes con on-prem.
        </p>
      </div>

      <div class="card" style="background:#0c1332">
        <div class="kicker">NSG y regla</div>
        <pre><code>az network nsg create \
  -g rg-demo \
  -n web-nsg

az network nsg rule create \
  -g rg-demo \
  --nsg-name web-nsg \
  -n allow-https \
  --priority 100 \
  --direction Inbound \
  --access Allow \
  --protocol Tcp \
  --destination-port-ranges 443</code></pre>
        <p class="small">
          Portal: <strong>Network security groups</strong>.  
          Ten cuidado con prioridades y rangos 0.0.0.0/0.
        </p>
      </div>

      <div class="card" style="background:#0c1332">
        <div class="kicker">Peering de VNets</div>
        <pre><code>az network vnet peering create \
  -g rg-demo \
  --vnet-name hub-vnet \
  -n hub-to-spoke1 \
  --remote-vnet spoke1-vnet \
  --allow-vnet-access</code></pre>
        <p class="small">
          Recuerda que el peering es bidireccional: normalmente creas uno en cada direcci√≥n.
        </p>
      </div>

      <div class="card" style="background:#0c1332">
        <div class="kicker">UDR simple</div>
        <pre><code>az network route-table create \
  -g rg-demo \
  -n rt-outbound

az network route-table route create \
  -g rg-demo \
  --route-table-name rt-outbound \
  -n default-to-fw \
  --address-prefix 0.0.0.0/0 \
  --next-hop-type VirtualAppliance \
  --next-hop-ip-address 10.10.0.4</code></pre>
        <p class="small">
          Luego asocias la route table a la subred deseada desde el portal.
        </p>
      </div>
    </div>

    <p class="muted small">
      Network Watcher, Connection Monitor y NSG flow logs tambi√©n son muy relevantes,
      sobre todo en preguntas de troubleshooting.
    </p>
  </div>

  <div class="card" id="escenarios">
    <h2>Escenarios tipo examen</h2>
    <ul>
      <li>
        <strong>Escenario 1: Hub-&amp;-Spoke con firewall central</strong><br>
        <span class="small">
          Varias VNets ‚Äúspoke‚Äù conectadas a un ‚Äúhub‚Äù. Todo el tr√°fico a Internet debe salir por un firewall en el hub.  
          Soluci√≥n:
          <ul>
            <li>Peering hub‚Üîspoke con <strong>Use remote gateway</strong> donde aplique.</li>
            <li><strong>UDR en los spokes</strong> enviando 0.0.0.0/0 al firewall.</li>
            <li>NSG filtrando tr√°fico en subredes clave.</li>
          </ul>
        </span>
      </li>
      <li>
        <strong>Escenario 2: Publicar web con WAF y SSL</strong><br>
        <span class="small">
          Una aplicaci√≥n web debe estar protegida contra ataques comunes (OWASP) y forzar HTTPS.  
          ‚Üí <strong>Application Gateway v2 con WAF</strong>, listeners HTTPS con certificado,
          redirecci√≥n HTTP‚ÜíHTTPS, y backends (VMs/VMSS/App Services).
        </span>
      </li>
      <li>
        <strong>Escenario 3: Storage accesible solo desde la VNet</strong><br>
        <span class="small">
          Un equipo quiere que un Storage Account no sea accesible desde Internet, solo desde workloads en VNets espec√≠ficas.  
          ‚Üí <strong>Private Endpoints</strong> en esas VNets, <strong>DNS privado</strong> y firewall de Storage
          restringiendo el resto.
        </span>
      </li>
      <li>
        <strong>Escenario 4: Problema de conexi√≥n entre VMs en VNets distintas</strong><br>
        <span class="small">
          No se pueden comunicar, pero los NSG parecen permitirlo.  
          Suele ser:
          <ul>
            <li>Falta de <strong>peering</strong> o peering mal configurado.</li>
            <li><strong>Solape de rangos</strong> de direcciones.</li>
          </ul>
        </span>
      </li>
      <li>
        <strong>Escenario 5: Conectividad h√≠brida con requisitos de baja latencia</strong><br>
        <span class="small">
          HQ tiene requisitos de latencia y seguridad altos para conectarse a Azure.  
          ‚Üí <strong>ExpressRoute</strong> (y a veces ExpressRoute + VPN failover).
        </span>
      </li>
    </ul>

    <div class="hl tip" style="margin-top:10px">
      <span class="pill">üß™ C√≥mo practicar</span>
      Dibuja topolog√≠as sencillas hub-&amp;-spoke, marca NSG, UDR, firewalls y Private Endpoints.
      Intenta seguir el camino de un paquete desde on-prem hasta una VM o un PaaS.
    </div>
  </div>

  <div class="card warnbox" id="errores">
    <h2>Errores comunes</h2>
    <ul>
      <li>
        <strong>Abrir RDP/SSH a 0.0.0.0/0</strong><br>
        <span class="small">
          En el examen, casi nunca es aceptable abrir 3389/22 al mundo.  
          Mejor: restringir origen, usar VPN/Bastion, o t√∫neles m√°s seguros.
        </span>
      </li>
      <li>
        <strong>Olvidar DNS en Private Link</strong><br>
        <span class="small">
          PE sin DNS correcto ‚Üí las apps seguir√°n yendo al endpoint p√∫blico.  
          F√≠jate en respuestas que mencionen <strong>Private DNS zones</strong>.
        </span>
      </li>
      <li>
        <strong>Suponer tr√°nsito autom√°tico con peering</strong><br>
        <span class="small">
          En hub-&amp;-spoke, que spoke A est√© conectado al hub y spoke B tambi√©n, no significa que A y B se vean entre s√≠.
        </span>
      </li>
      <li>
        <strong>Solapar rangos de IP entre on-prem y Azure</strong><br>
        <span class="small">
          Es un cl√°sico: el examen te pone un rango que solapa con el de on-prem y esa respuesta suele ser la incorrecta.
        </span>
      </li>
    </ul>
  </div>

  <div class="card" id="cross">
    <h2>Cross-links con otros dominios</h2>
    <ul>
      <li>
        <strong>Con c√≥mputo</strong><br>
        <span class="small">
          VMs y VMSS cuelgan de VNets/Subredes, se protegen con NSG, y se publican con LB/AppGW.
        </span>
      </li>
      <li>
        <strong>Con almacenamiento</strong><br>
        <span class="small">
          Private Endpoints para Storage, UDR y firewalls determinan el camino de acceso a datos.
        </span>
      </li>
      <li>
        <strong>Con identidades y gobierno</strong><br>
        <span class="small">
          Azure Policy para impedir IP p√∫blicas, forzar uso de Private Link o requerir NSG en subredes.
        </span>
      </li>
      <li>
        <strong>Con monitorizaci√≥n</strong><br>
        <span class="small">
          Network Watcher, NSG flow logs, Connection Monitor‚Ä¶ todo entra en el dominio de Monitor,
          pero se apoya en el dise√±o de red.
        </span>
      </li>
    </ul>

    <p class="muted small">
      Si en una pregunta aparecen redes + seguridad + PaaS, casi seguro que la respuesta mezcla NSG/UDR con Private Link
      y alguna Policy.
    </p>
  </div>

  <div class="footer">
    <span class="pill">üß† Consejo final</span>
    Ten siempre en mente este esquema: <strong>VNet ‚Üí Subred ‚Üí NSG/UDR ‚Üí Peering/VPN/ER ‚Üí PaaS con Private Link</strong>.
    Solo con eso ya lees las preguntas de red de otra forma.
  </div>

</div>
</body>
</html>
